<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Home · PencilFFTs.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">PencilFFTs.jl</span></div><form class="docs-search" action="search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li class="is-active"><a class="tocitem" href>Home</a><ul class="internal"><li><a class="tocitem" href="#Getting-started-1"><span>Getting started</span></a></li><li><a class="tocitem" href="#Implementation-details-1"><span>Implementation details</span></a></li><li><a class="tocitem" href="#Similar-projects-1"><span>Similar projects</span></a></li></ul></li><li><a class="tocitem" href="PencilFFTs/">PencilFFTs module</a></li><li><a class="tocitem" href="Transforms/">Transforms module</a></li><li><a class="tocitem" href="Pencils/">Pencils module</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Home</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Home</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/jipolanco/PencilFFTs.jl/blob/master/docs/src/index.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="PencilFFTs.jl-1"><a class="docs-heading-anchor" href="#PencilFFTs.jl-1">PencilFFTs.jl</a><a class="docs-heading-anchor-permalink" href="#PencilFFTs.jl-1" title="Permalink"></a></h1><p>Fast Fourier transforms of MPI-distributed Julia arrays.</p><p>This package provides functionality to distribute multidimensional arrays among MPI processes, and to perform multidimensional FFTs (and related transforms) on them.</p><p>The name of this package originates from the decomposition of 3D domains along two out of three dimensions, sometimes called <em>pencil</em> decomposition. This is illustrated by the figure below (<a href="https://hal.archives-ouvertes.fr/tel-02084215v1">source</a>), where each coloured block is managed by a different MPI process. Typically, one wants to compute FFTs on a scalar or vector field along the three spatial dimensions. In the case of a pencil decomposition, 3D FFTs are performed one dimension at a time (along the non-decomposed direction, using a serial FFT implementation). Global data transpositions are then needed to switch from one pencil configuration to the other and perform FFTs along the other dimensions.</p><p><img src="img/pencils.svg" alt="Pencil decomposition of 3D domains."/></p><p>The package is implemented in an efficient generic way that allows to decompose any <code>N</code>-dimensional geometry along <code>M &lt; N</code> dimensions (for the pencil decomposition described above, <code>N = 3</code> and <code>M = 2</code>). Moreover, the transforms applied along each dimension can be arbitrarily chosen among those supported by <code>FFTW</code>, including complex-to-complex, real-to-complex, and (very soon) real-to-real transforms.</p><h2 id="Getting-started-1"><a class="docs-heading-anchor" href="#Getting-started-1">Getting started</a><a class="docs-heading-anchor-permalink" href="#Getting-started-1" title="Permalink"></a></h2><p>Say you want to perform a 3D FFT of real periodic data defined on <span>$N_x × N_y × N_z$</span> grid points. The data is to be distributed over 12 MPI processes on a <span>$3 × 4$</span> grid, as in the figure above.</p><h3 id="Creating-plans-1"><a class="docs-heading-anchor" href="#Creating-plans-1">Creating plans</a><a class="docs-heading-anchor-permalink" href="#Creating-plans-1" title="Permalink"></a></h3><p>The first thing to do is to create a <a href="PencilFFTs/#PencilFFTs.PencilFFTPlan"><code>PencilFFTPlan</code></a>, which requires information on the global dimensions <span>$N_x × N_y × N_z$</span> of the data, on the transforms that will be applied, and on the way the data is distributed among MPI processes (the MPI Cartesian topology):</p><pre><code class="language-julia">using MPI
using PencilFFTs

MPI.Init()

# Input data dimensions (Nx × Ny × Nz)
dims = (16, 32, 64)

# Apply a real-to-complex (r2c) FFT
transform = Transforms.RFFT()

# MPI topology information
comm = MPI.COMM_WORLD  # we assume MPI.Comm_size(comm) == 12
proc_dims = (3, 4)     # 3×4 Cartesian topology

# Create plan
plan = PencilFFTPlan(dims, transform, proc_dims, comm)</code></pre><p>See the <a href="PencilFFTs/#PencilFFTs.PencilFFTPlan"><code>PencilFFTPlan</code></a> constructor for details on the accepted options, and the <a href="Transforms/#PencilFFTs.Transforms"><code>Transforms</code></a> module for the possible transforms. It is also possible to enable fine-grained performance measurements via the <a href="https://github.com/KristofferC/TimerOutputs.jl">TimerOutputs</a> package, as described in <a href="Pencils/#Pencils.measuring_performance-1">Measuring performance</a>.</p><h3 id="Allocating-data-1"><a class="docs-heading-anchor" href="#Allocating-data-1">Allocating data</a><a class="docs-heading-anchor-permalink" href="#Allocating-data-1" title="Permalink"></a></h3><p>Next, we want to apply the plan on some data. Transforms may only be applied on <a href="Pencils/#PencilFFTs.Pencils.PencilArray"><code>PencilArray</code></a>s, which are array wrappers that include MPI decomposition information. The helper function <a href="PencilFFTs/#PencilFFTs.allocate_input"><code>allocate_input</code></a> may be used to allocate a <code>PencilArray</code> that is compatible with our plan:</p><pre><code class="language-julia"># In our example, this returns a 3D PencilArray of real data (Float64).
u = allocate_input(plan)

# Fill the array with some (random) data
using Random
randn!(u)</code></pre><p><code>PencilArray</code>s are a subtype of <code>AbstractArray</code>, and thus they support all common array operations.</p><p>Similarly, to preallocate output data, one can use <a href="PencilFFTs/#PencilFFTs.allocate_output"><code>allocate_output</code></a>:</p><pre><code class="language-julia"># In our example, this returns a 3D PencilArray of complex data (Complex{Float64}).
v = allocate_output(plan)</code></pre><p>This is only required if one wants to apply the plans using a preallocated output (with <code>mul!</code>, see below).</p><h3 id="Applying-plans-1"><a class="docs-heading-anchor" href="#Applying-plans-1">Applying plans</a><a class="docs-heading-anchor-permalink" href="#Applying-plans-1" title="Permalink"></a></h3><p>The interface to apply plans is consistent with that of <a href="https://juliamath.github.io/AbstractFFTs.jl/stable/api/#AbstractFFTs.plan_fft"><code>AbstractFFTs</code></a>. Namely, <code>*</code> and <code>mul!</code> are respectively used for forward transforms without and with preallocated output data. Similarly, <code>\</code> and <code>ldiv!</code> are used for backward transforms.</p><pre><code class="language-julia">using LinearAlgebra  # for mul!, ldiv!

# Apply plan on `u` with `v` as an output
mul!(v, plan, u)

# Apply backward plan on `v` with `w` as an output
w = similar(u)
ldiv!(w, plan, v)  # now w ≈ u</code></pre><p>Note that, consistently with <code>AbstractFFTs</code>, backward transforms are normalised, so that the original data is recovered (possibly up to a very small error) when applying a forward followed by a backward transform.</p><p>Also note that, at this moment, in-place transforms are not supported.</p><h2 id="Implementation-details-1"><a class="docs-heading-anchor" href="#Implementation-details-1">Implementation details</a><a class="docs-heading-anchor-permalink" href="#Implementation-details-1" title="Permalink"></a></h2><p>The implementation of this package is modular. Distributed FFTs are built on top of the <a href="Pencils/#PencilFFTs.Pencils"><code>Pencils</code></a> module that handles data decomposition among MPI processes, including the definition of relevant data structures (e.g. <a href="Pencils/#PencilFFTs.Pencils.PencilArray"><code>PencilArray</code></a>) and global data transpositions (see <a href="Pencils/#LinearAlgebra.transpose!"><code>transpose!</code></a>). As such, the data decomposition functionality may be used independently of the FFTs. See the <a href="Pencils/#PencilFFTs.Pencils"><code>Pencils</code></a> module for more details.</p><h2 id="Similar-projects-1"><a class="docs-heading-anchor" href="#Similar-projects-1">Similar projects</a><a class="docs-heading-anchor-permalink" href="#Similar-projects-1" title="Permalink"></a></h2><ul><li><p><a href="https://www.p3dfft.net">P3DFFT</a> implements parallel 3D FFTs using pencil decomposition in Fortran and C++.</p></li><li><p><a href="http://www.2decomp.org">2DECOMP&amp;FFT</a> is another parallel 3D FFT library using pencil decomposition written in Fortran.</p></li></ul></article><nav class="docs-footer"><a class="docs-footer-nextpage" href="PencilFFTs/">PencilFFTs module »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Sunday 24 November 2019 18:55">Sunday 24 November 2019</span>. Using Julia version 1.2.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
