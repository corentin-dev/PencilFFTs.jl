<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Pencils module · PencilFFTs.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">PencilFFTs.jl</span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../PencilFFTs/">PencilFFTs module</a></li><li><a class="tocitem" href="../Transforms/">Transforms module</a></li><li class="is-active"><a class="tocitem" href>Pencils module</a><ul class="internal"><li><a class="tocitem" href="#Types-1"><span>Types</span></a></li><li><a class="tocitem" href="#Functions-1"><span>Functions</span></a></li><li><a class="tocitem" href="#Pencils.measuring_performance-1"><span>Measuring performance</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Pencils module</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Pencils module</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/jipolanco/PencilFFTs.jl/blob/master/docs/src/Pencils.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Pencils-module-1"><a class="docs-heading-anchor" href="#Pencils-module-1">Pencils module</a><a class="docs-heading-anchor-permalink" href="#Pencils-module-1" title="Permalink"></a></h1><article class="docstring"><header><a class="docstring-binding" id="PencilFFTs.Pencils" href="#PencilFFTs.Pencils"><code>PencilFFTs.Pencils</code></a> — <span class="docstring-category">Module</span></header><section><div><p>Module for multidimensional data decomposition using MPI.</p><p>Handles different decomposition configurations and data transpositions between them. Also defines relevant data structures for handling distributed data.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jipolanco/PencilFFTs.jl/blob/eff1887877c9adbcf21ca1987aacd68ff2a1db45/src/Pencils/Pencils.jl#L1-L6">source</a></section></article><h2 id="Types-1"><a class="docs-heading-anchor" href="#Types-1">Types</a><a class="docs-heading-anchor-permalink" href="#Types-1" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="PencilFFTs.Pencils.MPITopologies.MPITopology" href="#PencilFFTs.Pencils.MPITopologies.MPITopology"><code>PencilFFTs.Pencils.MPITopologies.MPITopology</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia">MPITopology{N}</code></pre><p>Describes an N-dimensional Cartesian MPI decomposition topology.</p><hr/><pre><code class="language-none">MPITopology(comm::MPI.Comm, pdims::Dims{N}) where N</code></pre><p>Create N-dimensional MPI topology information.</p><p>The <code>pdims</code> tuple specifies the number of MPI processes to put in every dimension of the topology. The product of its values must be equal to the number of processes in communicator <code>comm</code>.</p><p><strong>Example</strong></p><pre><code class="language-julia"># Divide 2D topology into 4×2 blocks.
comm = MPI.COMM_WORLD
@assert MPI.Comm_size(comm) == 8
topology = MPITopology(comm, (4, 2))</code></pre><hr/><pre><code class="language-none">MPITopology{N}(comm_cart::MPI.Comm) where N</code></pre><p>Create topology information from MPI communicator with Cartesian topology. The topology must have dimension <code>N</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jipolanco/PencilFFTs.jl/blob/eff1887877c9adbcf21ca1987aacd68ff2a1db45/src/Pencils/MPITopologies.jl#L9-L40">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PencilFFTs.Pencils.Pencil" href="#PencilFFTs.Pencils.Pencil"><code>PencilFFTs.Pencils.Pencil</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia">Pencil{N,M,T}</code></pre><p>Describes the decomposition of an <code>N</code>-dimensional Cartesian geometry among MPI processes along <code>M</code> directions (with <code>M &lt; N</code>).</p><p>The <code>Pencil</code> describes the decomposition of arrays of element type <code>T</code>.</p><hr/><pre><code class="language-none">Pencil(topology::MPITopology{M}, size_global::Dims{N},
       decomp_dims::Dims{M}, [element_type=Float64];
       permute=nothing, timer=TimerOutput())</code></pre><p>Define the decomposition of an <code>N</code>-dimensional geometry along <code>M</code> dimensions.</p><p>The dimensions of the geometry are given by <code>size_global = (N1, N2, ...)</code>. The <code>Pencil</code> describes the decomposition of an array of dimensions <code>size_global</code> and type <code>T</code> across a group of MPI processes.</p><p>Data is distributed over the given <code>M</code>-dimensional MPI topology (with <code>M &lt; N</code>). The decomposed dimensions are given by <code>decomp_dims</code>.</p><p>The optional parameter <code>perm</code> should be a tuple defining a permutation of the data indices. This may be useful for performance reasons, since it may be preferable (e.g. for FFTs) that the data is contiguous along the pencil direction.</p><p>It is also possible to pass a <code>TimerOutput</code> to the constructor. See <a href="#Pencils.measuring_performance-1">Measuring performance</a> for details.</p><p><strong>Examples</strong></p><p>Decompose a 3D geometry of global dimensions <span>$N_x × N_y × N_z = 4×8×12$</span> along the second (<span>$y$</span>) and third (<span>$z$</span>) dimensions.</p><pre><code class="language-julia">Pencil(topology, (4, 8, 12), (2, 3))             # data is in (x, y, z) order
Pencil(topology, (4, 8, 12), (2, 3), (3, 2, 1))  # data is in (z, y, x) order</code></pre><p>In the second case, the actual data is stored in <code>(z, y, x)</code> order within each MPI process.</p><hr/><pre><code class="language-none">Pencil(p::Pencil{N,M}, [element_type=eltype(p)];
       decomp_dims::Dims{M}=get_decomposition(p),
       size_global::Dims{N}=size_global(p),
       permute::P=get_permutation(p),
       timer::TimerOutput=get_timer(p))</code></pre><p>Create new pencil configuration from an existent one.</p><p>This constructor enables sharing temporary data buffers between the two pencil configurations, leading to reduced global memory usage.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jipolanco/PencilFFTs.jl/blob/eff1887877c9adbcf21ca1987aacd68ff2a1db45/src/Pencils/pencil.jl#L1-L55">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PencilFFTs.Pencils.PencilArray" href="#PencilFFTs.Pencils.PencilArray"><code>PencilFFTs.Pencils.PencilArray</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia">PencilArray(pencil::P, data::AbstractArray{T,N})</code></pre><p>Create array wrapper with pencil decomposition information.</p><p>The array dimensions and element type must be consistent with those of the given pencil.</p><p>The data array can have one or more extra dimensions to the left (fast indices). For instance, these may correspond to vector or tensor components.</p><p><strong>Example</strong></p><p>Suppose <code>pencil</code> has local dimensions <code>(10, 20, 30)</code>. Then:</p><pre><code class="language-julia">PencilArray(pencil, zeros(10, 20, 30))        # works (scalar)
PencilArray(pencil, zeros(3, 10, 20, 30))     # works (3-component vector)
PencilArray(pencil, zeros(4, 3, 10, 20, 30))  # works (4×3 tensor)
PencilArray(pencil, zeros(10, 20, 30, 3))     # fails</code></pre><hr/><pre><code class="language-none">PencilArray(pencil::Pencil, [extra_dims...])</code></pre><p>Allocate uninitialised <code>PencilArray</code> that can hold data in the local pencil.</p><p>Extra dimensions, for instance representing vector components, can be specified. These dimensions are added to the leftmost (fastest) indices of the resulting array.</p><p><strong>Example</strong></p><p>Suppose <code>pencil</code> has local dimensions <code>(10, 20, 30)</code>. Then:</p><pre><code class="language-julia">PencilArray(pencil)        # array dimensions are (10, 20, 30)
PencilArray(pencil, 4, 3)  # array dimensions are (4, 3, 10, 20, 30)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jipolanco/PencilFFTs.jl/blob/eff1887877c9adbcf21ca1987aacd68ff2a1db45/src/Pencils/arrays.jl#L1-L38">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PencilFFTs.Pencils.ShiftedArrays.ShiftedArrayView" href="#PencilFFTs.Pencils.ShiftedArrays.ShiftedArrayView"><code>PencilFFTs.Pencils.ShiftedArrays.ShiftedArrayView</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia">ShiftedArrayView{T,N}</code></pre><p>Wraps an array shifting its indices.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jipolanco/PencilFFTs.jl/blob/eff1887877c9adbcf21ca1987aacd68ff2a1db45/src/Pencils/ShiftedArrays.jl#L8-L12">source</a></section></article><h2 id="Functions-1"><a class="docs-heading-anchor" href="#Functions-1">Functions</a><a class="docs-heading-anchor-permalink" href="#Functions-1" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="Base.eltype" href="#Base.eltype"><code>Base.eltype</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">eltype(p::Pencil)</code></pre><p>Element type associated to the given pencil.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jipolanco/PencilFFTs.jl/blob/eff1887877c9adbcf21ca1987aacd68ff2a1db45/src/Pencils/pencil.jl#L153-L157">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PencilFFTs.Pencils.gather" href="#PencilFFTs.Pencils.gather"><code>PencilFFTs.Pencils.gather</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">gather(x::PencilArray, [root::Integer=0])</code></pre><p>Gather data from all MPI processes into one (big) array.</p><p>Data is received by the <code>root</code> process.</p><p>Returns the full array on the <code>root</code> process, and <code>nothing</code> on the other processes.</p><p>This can be useful for testing, but it shouldn&#39;t be used with very large datasets!</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jipolanco/PencilFFTs.jl/blob/eff1887877c9adbcf21ca1987aacd68ff2a1db45/src/Pencils/arrays.jl#L154-L166">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PencilFFTs.Pencils.MPITopologies.get_comm" href="#PencilFFTs.Pencils.MPITopologies.get_comm"><code>PencilFFTs.Pencils.MPITopologies.get_comm</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">get_comm(t::MPITopology)</code></pre><p>Get MPI communicator associated to an MPI Cartesian topology.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jipolanco/PencilFFTs.jl/blob/eff1887877c9adbcf21ca1987aacd68ff2a1db45/src/Pencils/MPITopologies.jl#L128-L132">source</a></section><section><div><pre><code class="language-none">get_comm(p::Pencil)</code></pre><p>Get MPI communicator associated to an MPI decomposition scheme.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jipolanco/PencilFFTs.jl/blob/eff1887877c9adbcf21ca1987aacd68ff2a1db45/src/Pencils/pencil.jl#L179-L183">source</a></section><section><div><pre><code class="language-none">get_comm(x::PencilArray)</code></pre><p>Get MPI communicator associated to a pencil-distributed array.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jipolanco/PencilFFTs.jl/blob/eff1887877c9adbcf21ca1987aacd68ff2a1db45/src/Pencils/arrays.jl#L131-L135">source</a></section><section><div><pre><code class="language-none">get_comm(p::PencilFFTPlan)</code></pre><p>Get MPI communicator associated to a <code>PencilFFTPlan</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jipolanco/PencilFFTs.jl/blob/eff1887877c9adbcf21ca1987aacd68ff2a1db45/src/pencil_plans.jl#L337-L341">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PencilFFTs.Pencils.get_decomposition" href="#PencilFFTs.Pencils.get_decomposition"><code>PencilFFTs.Pencils.get_decomposition</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">get_decomposition(p::Pencil)</code></pre><p>Get tuple with decomposed dimensions of the given pencil configuration.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jipolanco/PencilFFTs.jl/blob/eff1887877c9adbcf21ca1987aacd68ff2a1db45/src/Pencils/pencil.jl#L195-L199">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PencilFFTs.Pencils.get_permutation" href="#PencilFFTs.Pencils.get_permutation"><code>PencilFFTs.Pencils.get_permutation</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">get_permutation(p::Pencil)</code></pre><p>Get index permutation associated to the given pencil configuration.</p><p>Returns <code>nothing</code> if there is no associated permutation.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jipolanco/PencilFFTs.jl/blob/eff1887877c9adbcf21ca1987aacd68ff2a1db45/src/Pencils/pencil.jl#L186-L192">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PencilFFTs.Pencils.global_view" href="#PencilFFTs.Pencils.global_view"><code>PencilFFTs.Pencils.global_view</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">global_view(x::PencilArray)</code></pre><p>Create a <a href="#PencilFFTs.Pencils.ShiftedArrays.ShiftedArrayView"><code>ShiftedArrayView</code></a> of a <code>PencilArray</code> that takes global indices.</p><p>The order of indices in the returned view is the same as for the original array <code>x</code>. That is, if the indices of <code>x</code> are permuted, so are those of the returned array.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jipolanco/PencilFFTs.jl/blob/eff1887877c9adbcf21ca1987aacd68ff2a1db45/src/Pencils/arrays.jl#L138-L147">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PencilFFTs.Pencils.ShiftedArrays.has_indices" href="#PencilFFTs.Pencils.ShiftedArrays.has_indices"><code>PencilFFTs.Pencils.ShiftedArrays.has_indices</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">has_indices(x::ShiftedArrayView, indices...)</code></pre><p>Check whether the given set of indices is within the range of a shifted array.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jipolanco/PencilFFTs.jl/blob/eff1887877c9adbcf21ca1987aacd68ff2a1db45/src/Pencils/ShiftedArrays.jl#L74-L78">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Base.length" href="#Base.length"><code>Base.length</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">length(t::MPITopology)</code></pre><p>Get total size of Cartesian topology (i.e. total number of MPI processes).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jipolanco/PencilFFTs.jl/blob/eff1887877c9adbcf21ca1987aacd68ff2a1db45/src/Pencils/MPITopologies.jl#L121-L125">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Base.ndims" href="#Base.ndims"><code>Base.ndims</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">ndims(t::MPITopology)</code></pre><p>Get dimensionality of Cartesian topology.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jipolanco/PencilFFTs.jl/blob/eff1887877c9adbcf21ca1987aacd68ff2a1db45/src/Pencils/MPITopologies.jl#L107-L111">source</a></section><section><div><pre><code class="language-none">ndims(p::Pencil)</code></pre><p>Number of spatial dimensions associated to pencil data.</p><p>This corresponds to the total number of dimensions of the space, which includes the decomposed and non-decomposed dimensions.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jipolanco/PencilFFTs.jl/blob/eff1887877c9adbcf21ca1987aacd68ff2a1db45/src/Pencils/pencil.jl#L169-L176">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PencilFFTs.Pencils.ndims_extra" href="#PencilFFTs.Pencils.ndims_extra"><code>PencilFFTs.Pencils.ndims_extra</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">ndims_extra(x::PencilArray)</code></pre><p>Number of &quot;extra&quot; dimensions associated to <code>PencilArray</code>.</p><p>These are the dimensions that are not associated to the domain geometry. For instance, they may correspond to vector or tensor components.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jipolanco/PencilFFTs.jl/blob/eff1887877c9adbcf21ca1987aacd68ff2a1db45/src/Pencils/arrays.jl#L100-L107">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Base.parent" href="#Base.parent"><code>Base.parent</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">parent(x::PencilArray)</code></pre><p>Returns array wrapped by a <code>PencilArray</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jipolanco/PencilFFTs.jl/blob/eff1887877c9adbcf21ca1987aacd68ff2a1db45/src/Pencils/arrays.jl#L93-L97">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PencilFFTs.Pencils.pencil" href="#PencilFFTs.Pencils.pencil"><code>PencilFFTs.Pencils.pencil</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">pencil(x::PencilArray)</code></pre><p>Returns decomposition configuration associated to the <code>PencilArray</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jipolanco/PencilFFTs.jl/blob/eff1887877c9adbcf21ca1987aacd68ff2a1db45/src/Pencils/arrays.jl#L86-L90">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PencilFFTs.Pencils.range_local" href="#PencilFFTs.Pencils.range_local"><code>PencilFFTs.Pencils.range_local</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">range_local(p::Pencil; permute=true)</code></pre><p>Local data range held by the pencil.</p><p>By default the dimensions are permuted to match those of the associated data arrays.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jipolanco/PencilFFTs.jl/blob/eff1887877c9adbcf21ca1987aacd68ff2a1db45/src/Pencils/pencil.jl#L202-L209">source</a></section><section><div><pre><code class="language-none">range_local(x::PencilArray; permute=true)</code></pre><p>Local data range held by the PencilArray.</p><p>By default the dimensions are permuted to match the order of indices in the array.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jipolanco/PencilFFTs.jl/blob/eff1887877c9adbcf21ca1987aacd68ff2a1db45/src/Pencils/arrays.jl#L120-L127">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Base.size" href="#Base.size"><code>Base.size</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">size(t::MPITopology)</code></pre><p>Get dimensions of Cartesian topology.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jipolanco/PencilFFTs.jl/blob/eff1887877c9adbcf21ca1987aacd68ff2a1db45/src/Pencils/MPITopologies.jl#L114-L118">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PencilFFTs.Pencils.size_global" href="#PencilFFTs.Pencils.size_global"><code>PencilFFTs.Pencils.size_global</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">size_global(p::Pencil)</code></pre><p>Global dimensions of the Cartesian grid associated to the given domain decomposition.</p><p>Unlike <code>size_local</code>, the returned dimensions are <em>not</em> permuted to match the dimensions of the local data.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jipolanco/PencilFFTs.jl/blob/eff1887877c9adbcf21ca1987aacd68ff2a1db45/src/Pencils/pencil.jl#L224-L232">source</a></section><section><div><pre><code class="language-none">size_global(x::PencilArray)</code></pre><p>Global dimensions associated to the given array.</p><p>Unlike <code>size</code>, the returned dimensions are <em>not</em> permuted according to the associated pencil configuration.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jipolanco/PencilFFTs.jl/blob/eff1887877c9adbcf21ca1987aacd68ff2a1db45/src/Pencils/arrays.jl#L110-L117">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PencilFFTs.Pencils.size_local" href="#PencilFFTs.Pencils.size_local"><code>PencilFFTs.Pencils.size_local</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">size_local(p::Pencil; permute=true)</code></pre><p>Local dimensions of the data held by the pencil.</p><p>By default the dimensions are permuted to match those of the associated data arrays.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jipolanco/PencilFFTs.jl/blob/eff1887877c9adbcf21ca1987aacd68ff2a1db45/src/Pencils/pencil.jl#L213-L220">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PencilFFTs.Pencils.to_local" href="#PencilFFTs.Pencils.to_local"><code>PencilFFTs.Pencils.to_local</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">to_local(p::Pencil, global_inds; permute=true)</code></pre><p>Convert non-permuted global indices to local indices.</p><p>Indices are permuted by default using the permutation associated to the pencil configuration <code>p</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jipolanco/PencilFFTs.jl/blob/eff1887877c9adbcf21ca1987aacd68ff2a1db45/src/Pencils/pencil.jl#L235-L242">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="LinearAlgebra.transpose!" href="#LinearAlgebra.transpose!"><code>LinearAlgebra.transpose!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">transpose!(dest::PencilArray{T,N}, src::PencilArray{T,N};
           method=TransposeMethods.IsendIrecv())</code></pre><p>Transpose data from one pencil configuration to the other.</p><p>The two pencil configurations must be compatible for transposition:</p><ul><li><p>they must share the same MPI Cartesian topology,</p></li><li><p>they must have the same global data size,</p></li><li><p>when written as a sorted tuple, the decomposed dimensions must be almost the same, with at most one difference. For instance, if the input of a 3D dataset is decomposed in <code>(2, 3)</code>, then the output may be decomposed in <code>(1, 3)</code>, but not in <code>(1, 2)</code>. If the decomposed dimensions are the same, then no transposition is performed, and data is just copied if needed.</p></li></ul><p><strong>Performance tuning</strong></p><p>The <code>method</code> argument allows to choose between transposition implementations. This can be useful to tune performance of MPI data transfers. Two values are currently accepted:</p><ul><li><p><code>TransposeMethods.IsendIrecv()</code> uses non-blocking point-to-point data transfers (<code>MPI_Isend</code> and <code>MPI_Irecv</code>). This may be more performant since data transfers are interleaved with local data transpositions (index permutation of received data). This is the default.</p></li><li><p><code>TransposeMethods.Alltoallv()</code> uses <code>MPI_Alltoallv</code> for global data transpositions.</p></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jipolanco/PencilFFTs.jl/blob/eff1887877c9adbcf21ca1987aacd68ff2a1db45/src/Pencils/transpose.jl#L15-L48">source</a></section></article><h2 id="Pencils.measuring_performance-1"><a class="docs-heading-anchor" href="#Pencils.measuring_performance-1">Measuring performance</a><a class="docs-heading-anchor-permalink" href="#Pencils.measuring_performance-1" title="Permalink"></a></h2><p>It is possible to measure the time spent in different sections of the MPI data transposition routines using the <a href="https://github.com/KristofferC/TimerOutputs.jl">TimerOutput</a> package. This has a (very small) performance overhead, so it is disabled by default. To enable time measurements, call <code>TimerOutputs.enable_debug_timings(PencilFFTs.Pencils)</code> after loading <code>PencilFFTs</code>. For more details see the <a href="https://github.com/KristofferC/TimerOutputs.jl#overhead">TimerOutput docs</a>.</p><p>Minimal example:</p><pre><code class="language-julia">using MPI
using PencilFFTs.Pencils
using TimerOutput

# Enable timing of `Pencils` functions
TimerOutputs.enable_debug_timings(PencilFFTs.Pencils)

MPI.Init()

pencil = Pencil(#= args... =#)

# [do stuff with `pencil`...]

# Retrieve and print timing data associated to `plan`
to = get_timer(pencil)
print_timer(to)</code></pre><p>By default, each <code>Pencil</code> has its own <code>TimerOutput</code>. If you already have a <code>TimerOutput</code>, you can pass it to the <a href="#PencilFFTs.Pencils.Pencil"><code>Pencil</code></a> constructor:</p><pre><code class="language-julia">to = TimerOutput()
pencil = Pencil(..., timer=to)

# [do stuff with `pencil`...]

print_timer(to)</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../Transforms/">« Transforms module</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Sunday 24 November 2019 18:55">Sunday 24 November 2019</span>. Using Julia version 1.2.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
