<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Home · PencilFFTs.jl</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link href="assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>PencilFFTs.jl</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li class="current"><a class="toctext" href>Home</a><ul class="internal"><li><a class="toctext" href="#Getting-started-1">Getting started</a></li><li><a class="toctext" href="#Implementation-details-1">Implementation details</a></li><li><a class="toctext" href="#Similar-projects-1">Similar projects</a></li></ul></li><li><a class="toctext" href="PencilFFTs/">PencilFFTs module</a></li><li><a class="toctext" href="Transforms/">Transforms module</a></li><li><a class="toctext" href="Pencils/">Pencils module</a></li></ul></nav><article id="docs"><header><nav><ul><li><a href>Home</a></li></ul><a class="edit-page" href="https://github.com/jipolanco/PencilFFTs.jl/blob/master/docs/src/index.md"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>Home</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="PencilFFTs.jl-1" href="#PencilFFTs.jl-1">PencilFFTs.jl</a></h1><p>Fast Fourier transforms of MPI-distributed Julia arrays.</p><p>This package provides functionality to distribute multidimensional arrays among MPI processes, and to perform multidimensional FFTs (and related transforms) on them.</p><p>The name of this package originates from the decomposition of 3D domains along two out of three dimensions, sometimes called <em>pencil</em> decomposition. This is illustrated by the figure below (<a href="https://hal.archives-ouvertes.fr/tel-02084215v1">source</a>), where each coloured block is managed by a different MPI process. Typically, one wants to compute FFTs on a scalar or vector field along the three spatial dimensions. In the case of a pencil decomposition, 3D FFTs are performed one dimension at a time (along the non-decomposed direction, using a serial FFT implementation). Global data transpositions are then needed to switch from one pencil configuration to the other and perform FFTs along the other dimensions.</p><p><img src="img/pencils.svg" alt="Pencil decomposition of 3D domains."/></p><p>The package is implemented in an efficient generic way that allows to decompose any <code>N</code>-dimensional geometry along <code>M &lt; N</code> dimensions (for the pencil decomposition described above, <code>N = 3</code> and <code>M = 2</code>). Moreover, the transforms applied along each dimension can be arbitrarily chosen among those supported by <code>FFTW</code>, including complex-to-complex, real-to-complex, and (very soon) real-to-real transforms.</p><h2><a class="nav-anchor" id="Getting-started-1" href="#Getting-started-1">Getting started</a></h2><p>Say you want to perform a 3D FFT of real periodic data defined on <span>$N_x × N_y × N_z$</span> grid points. The data is to be distributed over 12 MPI processes on a <span>$3 × 4$</span> grid, as in the figure above.</p><h3><a class="nav-anchor" id="Creating-plans-1" href="#Creating-plans-1">Creating plans</a></h3><p>The first thing to do is to create a <a href="PencilFFTs/#PencilFFTs.PencilFFTPlan"><code>PencilFFTPlan</code></a>, which requires information on the global dimensions <span>$N_x × N_y × N_z$</span> of the data, on the transforms that will be applied, and on the way the data is distributed among MPI processes (the MPI Cartesian topology):</p><pre><code class="language-julia">using MPI
using PencilFFTs

MPI.Init()

# Input data dimensions (Nx × Ny × Nz)
dims = (16, 32, 64)

# Apply a real-to-complex (r2c) FFT
transform = Transforms.RFFT()

# MPI topology information
comm = MPI.COMM_WORLD  # we assume MPI.Comm_size(comm) == 12
proc_dims = (3, 4)     # 3×4 Cartesian topology

# Create plan
plan = PencilFFTPlan(dims, transform, proc_dims, comm)</code></pre><p>See the <a href="PencilFFTs/#PencilFFTs.PencilFFTPlan"><code>PencilFFTPlan</code></a> constructor for details on the accepted options, and the <a href="Transforms/#PencilFFTs.Transforms"><code>Transforms</code></a> module for the possible transforms. It is also possible to enable fine-grained performance measurements via the <a href="https://github.com/KristofferC/TimerOutputs.jl">TimerOutputs</a> package, as described in <a href="Pencils/#Pencils.measuring_performance-1">Measuring performance</a>.</p><h3><a class="nav-anchor" id="Allocating-data-1" href="#Allocating-data-1">Allocating data</a></h3><p>Next, we want to apply the plan on some data. Transforms may only be applied on <a href="Pencils/#PencilFFTs.Pencils.PencilArray"><code>PencilArray</code></a>s, which are array wrappers that include MPI decomposition information. The helper function <a href="PencilFFTs/#PencilFFTs.allocate_input"><code>allocate_input</code></a> may be used to allocate a <code>PencilArray</code> that is compatible with our plan:</p><pre><code class="language-julia"># In our example, this returns a 3D PencilArray of real data (Float64).
u = allocate_input(plan)

# Fill the array with some (random) data
using Random
randn!(u)</code></pre><p><code>PencilArray</code>s are a subtype of <code>AbstractArray</code>, and thus they support all common array operations.</p><p>Similarly, to preallocate output data, one can use <a href="PencilFFTs/#PencilFFTs.allocate_output"><code>allocate_output</code></a>:</p><pre><code class="language-julia"># In our example, this returns a 3D PencilArray of complex data (Complex{Float64}).
v = allocate_output(plan)</code></pre><p>This is only required if one wants to apply the plans using a preallocated output (with <code>mul!</code>, see below).</p><h3><a class="nav-anchor" id="Applying-plans-1" href="#Applying-plans-1">Applying plans</a></h3><p>The interface to apply plans is consistent with that of <a href="https://juliamath.github.io/AbstractFFTs.jl/stable/api/#AbstractFFTs.plan_fft"><code>AbstractFFTs</code></a>. Namely, <code>*</code> and <code>mul!</code> are respectively used for forward transforms without and with preallocated output data. Similarly, <code>\</code> and <code>ldiv!</code> are used for backward transforms.</p><pre><code class="language-julia">using LinearAlgebra  # for mul!, ldiv!

# Apply plan on `u` with `v` as an output
mul!(v, plan, u)

# Apply backward plan on `v` with `w` as an output
w = similar(u)
ldiv!(w, plan, v)  # now w ≈ u</code></pre><p>Note that, consistently with <code>AbstractFFTs</code>, backward transforms are normalised, so that the original data is recovered (possibly up to a very small error) when applying a forward followed by a backward transform.</p><p>Also note that, at this moment, in-place transforms are not supported.</p><h2><a class="nav-anchor" id="Implementation-details-1" href="#Implementation-details-1">Implementation details</a></h2><p>The implementation of this package is modular. Distributed FFTs are built on top of the <a href="Pencils/#PencilFFTs.Pencils"><code>Pencils</code></a> module that handles data decomposition among MPI processes, including the definition of relevant data structures (e.g. <a href="Pencils/#PencilFFTs.Pencils.PencilArray"><code>PencilArray</code></a>) and global data transpositions (see <a href="Pencils/#LinearAlgebra.transpose!"><code>transpose!</code></a>). As such, the data decomposition functionality may be used independently of the FFTs. See the <a href="Pencils/#PencilFFTs.Pencils"><code>Pencils</code></a> module for more details.</p><h2><a class="nav-anchor" id="Similar-projects-1" href="#Similar-projects-1">Similar projects</a></h2><ul><li><p><a href="https://www.p3dfft.net">P3DFFT</a> implements parallel 3D FFTs using pencil decomposition in Fortran and C++.</p></li><li><p><a href="http://www.2decomp.org">2DECOMP&amp;FFT</a> is another parallel 3D FFT library using pencil decomposition written in Fortran.</p></li></ul><footer><hr/><a class="next" href="PencilFFTs/"><span class="direction">Next</span><span class="title">PencilFFTs module</span></a></footer></article></body></html>
