<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Distributed FFTs · PencilFFTs.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link href="../assets/custom.css" rel="stylesheet" type="text/css"/><script src="../assets/matomo.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.svg" alt="PencilFFTs.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit">PencilFFTs.jl</span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../tutorial/">Tutorial</a></li><li><span class="tocitem">More examples</span><ul><li><a class="tocitem" href="../examples/in-place/">In-place transforms</a></li><li><a class="tocitem" href="../examples/gradient/">Gradient of a scalar field</a></li></ul></li><li><span class="tocitem">Library</span><ul><li class="is-active"><a class="tocitem" href>Distributed FFTs</a><ul class="internal"><li><a class="tocitem" href="#Types-1"><span>Types</span></a></li><li><a class="tocitem" href="#Functions-1"><span>Functions</span></a></li><li><a class="tocitem" href="#PencilFFTs.measuring_performance-1"><span>Measuring performance</span></a></li><li><a class="tocitem" href="#Internals-1"><span>Internals</span></a></li><li><a class="tocitem" href="#Index-1"><span>Index</span></a></li></ul></li><li><a class="tocitem" href="../Transforms/">Available transforms</a></li><li><a class="tocitem" href="../PencilArrays/">MPI-distributed data</a></li><li><a class="tocitem" href="../PencilIO/">Parallel I/O</a></li></ul></li><li><a class="tocitem" href="../benchmarks/">Benchmarks</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Library</a></li><li class="is-active"><a href>Distributed FFTs</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Distributed FFTs</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/jipolanco/PencilFFTs.jl/blob/master/docs/src/PencilFFTs.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Distributed-FFTs-1"><a class="docs-heading-anchor" href="#Distributed-FFTs-1">Distributed FFTs</a><a class="docs-heading-anchor-permalink" href="#Distributed-FFTs-1" title="Permalink"></a></h1><p>Distributed FFTs are built on top of the <a href="../PencilArrays/#PencilFFTs.PencilArrays"><code>PencilArrays</code></a> and the <a href="../Transforms/#PencilFFTs.Transforms"><code>Transforms</code></a> modules, and are implemented in the <code>PencilFFTs</code> module.</p><h2 id="Types-1"><a class="docs-heading-anchor" href="#Types-1">Types</a><a class="docs-heading-anchor-permalink" href="#Types-1" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="PencilFFTs.PencilFFTPlan" href="#PencilFFTs.PencilFFTPlan"><code>PencilFFTs.PencilFFTPlan</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia">PencilFFTPlan{T,N}</code></pre><p>Plan for N-dimensional FFT-based transform on MPI-distributed data.</p><hr/><pre><code class="language-none">PencilFFTPlan(size_global::Dims{N}, transforms,
              proc_dims::Dims{M}, comm::MPI.Comm, [real_type=Float64];
              extra_dims=(),
              fftw_flags=FFTW.ESTIMATE, fftw_timelimit=FFTW.NO_TIMELIMIT,
              permute_dims=Val(true),
              transpose_method=Transpositions.IsendIrecv(),
              timer=TimerOutput(),
              )</code></pre><p>Create plan for N-dimensional transform.</p><p><code>size_global</code> specifies the global dimensions of the input data.</p><p><code>transforms</code> should be a tuple of length <code>N</code> specifying the transforms to be applied along each dimension. Each element must be a subtype of <a href="../Transforms/#PencilFFTs.Transforms.AbstractTransform"><code>Transforms.AbstractTransform</code></a>. For all the possible transforms, see <a href="../Transforms/#Transform-types-1">Transform types</a>. Alternatively, <code>transforms</code> may be a single transform that will be automatically expanded into <code>N</code> equivalent transforms. This is illustrated in the example below.</p><p>The transforms are applied one dimension at a time, with the leftmost dimension first for forward transforms. For multidimensional transforms of real data, this means that a real-to-complex transform must be performed along the first dimension, and then complex-to-complex transforms are performed along the other two dimensions (see example below).</p><p>The data is distributed over the MPI processes in the <code>comm</code> communicator. The distribution is performed over <code>M</code> dimensions (with <code>M &lt; N</code>) according to the values in <code>proc_dims</code>, which specifies the number of MPI processes to put along each dimension.</p><p><strong>Optional arguments</strong></p><ul><li><p>The floating point precision can be selected by setting <code>real_type</code> parameter, which is <code>Float64</code> by default.</p></li><li><p><code>extra_dims</code> may be used to specify the sizes of one or more extra dimensions that should not be transformed. These dimensions will be added to the rightmost (i.e. slowest) indices of the arrays. See <strong>Extra dimensions</strong> below for usage hints.</p></li><li><p>The keyword arguments <code>fftw_flags</code> and <code>fftw_timelimit</code> are passed to the <code>FFTW</code> plan creation functions (see <a href="https://juliamath.github.io/AbstractFFTs.jl/stable/api/#AbstractFFTs.plan_fft"><code>AbstractFFTs</code> docs</a>).</p></li><li><p><code>permute_dims</code> determines whether the indices of the output data should be reversed. For instance, if the input data has global dimensions <code>(Nx, Ny, Nz)</code>, then the output of a complex-to-complex FFT would have dimensions <code>(Nz, Ny, Nx)</code>. This enables FFTs to always be performed along the first (i.e. fastest) array dimension, which could lead to performance gains. This option is enabled by default. For type inference reasons, it must be a value type (<code>Val(true)</code> or <code>Val(false)</code>).</p></li><li><p><code>transpose_method</code> allows to select between implementations of the global data transpositions. See the <a href="../PencilArrays/#LinearAlgebra.transpose!"><code>transpose!</code></a> docs for details.</p></li><li><p><code>timer</code> should be a <code>TimerOutput</code> object. See <a href="#PencilFFTs.measuring_performance-1">Measuring performance</a> for details.</p></li></ul><p><strong>Extra dimensions</strong></p><p>One possible application of <code>extra_dims</code> is for describing the components of a vector or tensor field. However, this means that different <code>PencilFFTPlan</code>s would need to be created for each kind of field (scalar, vector, ...). To avoid the creation of multiple plans, a possibly better alternative is to create tuples (or arrays) of <code>PencilArray</code>s using <a href="#PencilFFTs.allocate_input"><code>allocate_input</code></a> and <a href="#PencilFFTs.allocate_output"><code>allocate_output</code></a>.</p><p>Another more legitimate usage of <code>extra_dims</code> is to specify one or more Cartesian dimensions that should not be transformed nor split among MPI processes.</p><p><strong>Example</strong></p><p>Suppose we want to perform a 3D transform of real data. The data is to be decomposed along two dimensions, over 8 MPI processes:</p><pre><code class="language-julia">size_global = (64, 32, 128)  # size of real input data

# Perform real-to-complex transform along the first dimension, then
# complex-to-complex transforms along the other dimensions.
transforms = (Transforms.RFFT(), Transforms.FFT(), Transforms.FFT())
# transforms = Transforms.RFFT()  # this is equivalent to the above line

proc_dims = (4, 2)  # 2D decomposition
comm = MPI.COMM_WORLD

plan = PencilFFTPlan(size_global, transforms, proc_dims, comm)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jipolanco/PencilFFTs.jl/blob/a7ddb1270af5ed3f6a1f0f4c616ed0a9915caf6a/src/pencil_plans.jl#L26-L124">source</a></section></article><h2 id="Functions-1"><a class="docs-heading-anchor" href="#Functions-1">Functions</a><a class="docs-heading-anchor-permalink" href="#Functions-1" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="PencilFFTs.allocate_input" href="#PencilFFTs.allocate_input"><code>PencilFFTs.allocate_input</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">allocate_input(p::PencilFFTPlan)          -&gt; PencilArray
allocate_input(p::PencilFFTPlan, dims...) -&gt; Array{PencilArray}
allocate_input(p::PencilFFTPlan, Val(N))  -&gt; NTuple{N, PencilArray}</code></pre><p>Allocate uninitialised <a href="../PencilArrays/#PencilFFTs.PencilArrays.PencilArray"><code>PencilArray</code></a> that can hold input data for the given plan.</p><p>The second and third forms respectively allocate an array of <code>PencilArray</code>s of size <code>dims</code>, and a tuple of <code>N</code> <code>PencilArray</code>s.</p><div class="admonition is-info"><header class="admonition-header">In-place plans</header><div class="admonition-body"><p>If <code>p</code> is an in-place plan, a <a href="../PencilArrays/#PencilFFTs.PencilArrays.ManyPencilArray"><code>ManyPencilArray</code></a> is allocated. This type holds <code>PencilArray</code> wrappers for the input and output transforms (as well as for intermediate transforms) which share the same space in memory. The input and output <code>PencilArray</code>s should be respectively accessed by calling <a href="../PencilArrays/#Base.first-Tuple{ManyPencilArray}"><code>first(::ManyPencilArray)</code></a> and <a href="../PencilArrays/#Base.last-Tuple{ManyPencilArray}"><code>last(::ManyPencilArray)</code></a>.</p><h4>Example</h4><p>Suppose <code>p</code> is an in-place <code>PencilFFTPlan</code>. Then,</p><pre><code class="language-julia">@assert is_inplace(p)
A = allocate_input(p) :: ManyPencilArray
v_in = first(A)       :: PencilArray  # input data view
v_out = last(A)       :: PencilArray  # output data view</code></pre><p>Also note that in-place plans must be performed directly on the returned <code>ManyPencilArray</code>, and not on the contained <code>PencilArray</code> views:</p><pre><code class="language-julia">p * A       # perform forward transform in-place
p \ A       # perform backward transform in-place
# p * v_in  # not allowed!!</code></pre></div></div></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jipolanco/PencilFFTs.jl/blob/a7ddb1270af5ed3f6a1f0f4c616ed0a9915caf6a/src/pencil_plans.jl#L415-L452">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PencilFFTs.allocate_output" href="#PencilFFTs.allocate_output"><code>PencilFFTs.allocate_output</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">allocate_output(p::PencilFFTPlan)          -&gt; PencilArray
allocate_output(p::PencilFFTPlan, dims...) -&gt; Array{PencilArray}
allocate_output(p::PencilFFTPlan, Val(N))  -&gt; NTuple{N, PencilArray}</code></pre><p>Allocate uninitialised <a href="../PencilArrays/#PencilFFTs.PencilArrays.PencilArray"><code>PencilArray</code></a> that can hold output data for the given plan.</p><p>If <code>p</code> is an in-place plan, a <a href="../PencilArrays/#PencilFFTs.PencilArrays.ManyPencilArray"><code>ManyPencilArray</code></a> is allocated.</p><p>See <a href="#PencilFFTs.allocate_input"><code>allocate_input</code></a> for details.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jipolanco/PencilFFTs.jl/blob/a7ddb1270af5ed3f6a1f0f4c616ed0a9915caf6a/src/pencil_plans.jl#L474-L485">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PencilFFTs.PencilArrays.MPITopologies.get_comm-Tuple{PencilFFTPlan}" href="#PencilFFTs.PencilArrays.MPITopologies.get_comm-Tuple{PencilFFTPlan}"><code>PencilFFTs.PencilArrays.MPITopologies.get_comm</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">get_comm(p::PencilFFTPlan)</code></pre><p>Get MPI communicator associated to a <code>PencilFFTPlan</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jipolanco/PencilFFTs.jl/blob/a7ddb1270af5ed3f6a1f0f4c616ed0a9915caf6a/src/pencil_plans.jl#L392-L396">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PencilFFTs.get_scale_factor-Tuple{PencilFFTPlan}" href="#PencilFFTs.get_scale_factor-Tuple{PencilFFTPlan}"><code>PencilFFTs.get_scale_factor</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">get_scale_factor(p::PencilFFTPlan)</code></pre><p>Get scale factor associated to a <code>PencilFFTPlan</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jipolanco/PencilFFTs.jl/blob/a7ddb1270af5ed3f6a1f0f4c616ed0a9915caf6a/src/pencil_plans.jl#L399-L403">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PencilFFTs.PencilArrays.get_timer-Tuple{PencilFFTPlan}" href="#PencilFFTs.PencilArrays.get_timer-Tuple{PencilFFTPlan}"><code>PencilFFTs.PencilArrays.get_timer</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">get_timer(p::PencilFFTPlan)</code></pre><p>Get <code>TimerOutput</code> attached to a <code>PencilFFTPlan</code>.</p><p>See <a href="#PencilFFTs.measuring_performance-1">Measuring performance</a> for details.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jipolanco/PencilFFTs.jl/blob/a7ddb1270af5ed3f6a1f0f4c616ed0a9915caf6a/src/pencil_plans.jl#L406-L412">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PencilFFTs.Transforms.is_inplace-Tuple{PencilFFTPlan}" href="#PencilFFTs.Transforms.is_inplace-Tuple{PencilFFTPlan}"><code>PencilFFTs.Transforms.is_inplace</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">Transforms.is_inplace(p::PencilFFTPlan)</code></pre><p>Returns <code>true</code> if the given plan operates in-place on the input data, <code>false</code> otherwise.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jipolanco/PencilFFTs.jl/blob/a7ddb1270af5ed3f6a1f0f4c616ed0a9915caf6a/src/pencil_plans.jl#L216-L221">source</a></section></article><h2 id="PencilFFTs.measuring_performance-1"><a class="docs-heading-anchor" href="#PencilFFTs.measuring_performance-1">Measuring performance</a><a class="docs-heading-anchor-permalink" href="#PencilFFTs.measuring_performance-1" title="Permalink"></a></h2><p>It is possible to measure the time spent in different sections of the distributed transforms using the <a href="https://github.com/KristofferC/TimerOutputs.jl">TimerOutputs</a> package. This has a (very small) performance overhead, so it is disabled by default. To enable time measurements, call <code>TimerOutputs.enable_debug_timings</code> after loading <code>PencilFFTs</code> (see below for an example). For more details see the <a href="https://github.com/KristofferC/TimerOutputs.jl#overhead">TimerOutputs docs</a>.</p><p>Minimal example:</p><pre><code class="language-julia">using MPI
using PencilFFTs
using TimerOutputs

# Enable timing of `PencilFFTs` functions
TimerOutputs.enable_debug_timings(PencilFFTs)
TimerOutputs.enable_debug_timings(PencilArrays)
TimerOutputs.enable_debug_timings(Transpositions)

MPI.Init()

plan = PencilFFTPlan(#= args... =#)

# [do stuff with `plan`...]

# Retrieve and print timing data associated to `plan`
to = get_timer(plan)
print_timer(to)</code></pre><p>By default, each <code>PencilFFTPlan</code> has its own <code>TimerOutput</code>. If you already have a <code>TimerOutput</code>, you can pass it to the <a href="#PencilFFTs.PencilFFTPlan"><code>PencilFFTPlan</code></a> constructor:</p><pre><code class="language-julia">to = TimerOutput()
plan = PencilFFTPlan(..., timer=to)

# [do stuff with `plan`...]

print_timer(to)</code></pre><h2 id="Internals-1"><a class="docs-heading-anchor" href="#Internals-1">Internals</a><a class="docs-heading-anchor-permalink" href="#Internals-1" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="PencilFFTs.GlobalFFTParams" href="#PencilFFTs.GlobalFFTParams"><code>PencilFFTs.GlobalFFTParams</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia">GlobalFFTParams{T, N, inplace}</code></pre><p>Specifies the global parameters for an N-dimensional distributed transform. These include the element type <code>T</code> and global data sizes of input and output data, as well as the transform types to be performed along each dimension.</p><hr/><pre><code class="language-none">GlobalFFTParams(size_global, transforms, [real_type=Float64])</code></pre><p>Define parameters for N-dimensional transform.</p><p><code>transforms</code> must be a tuple of length <code>N</code> specifying the transforms to be applied along each dimension. Each element must be a subtype of <a href="../Transforms/#PencilFFTs.Transforms.AbstractTransform"><code>Transforms.AbstractTransform</code></a>. For all the possible transforms, see <a href="../Transforms/#PencilFFTs.Transforms"><code>Transform types</code></a>.</p><p>The element type must be a real type accepted by FFTW, i.e. either <code>Float32</code> or <code>Float64</code>.</p><p>Note that the transforms are applied one dimension at a time, with the leftmost dimension first for forward transforms.</p><p><strong>Example</strong></p><p>To perform a 3D FFT of real data, first a real-to-complex FFT must be applied along the first dimension, followed by two complex-to-complex FFTs along the other dimensions:</p><pre><code class="language-julia-repl">julia&gt; size_global = (64, 32, 128);  # size of real input data

julia&gt; transforms = (Transforms.RFFT(), Transforms.FFT(), Transforms.FFT());

julia&gt; fft_params = PencilFFTs.GlobalFFTParams(size_global, transforms);</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jipolanco/PencilFFTs.jl/blob/a7ddb1270af5ed3f6a1f0f4c616ed0a9915caf6a/src/global_fft.jl#L1-L39">source</a></section></article><h2 id="Index-1"><a class="docs-heading-anchor" href="#Index-1">Index</a><a class="docs-heading-anchor-permalink" href="#Index-1" title="Permalink"></a></h2><ul><li><a href="#PencilFFTs.GlobalFFTParams"><code>PencilFFTs.GlobalFFTParams</code></a></li><li><a href="#PencilFFTs.PencilFFTPlan"><code>PencilFFTs.PencilFFTPlan</code></a></li><li><a href="#PencilFFTs.PencilArrays.MPITopologies.get_comm-Tuple{PencilFFTPlan}"><code>PencilFFTs.PencilArrays.MPITopologies.get_comm</code></a></li><li><a href="#PencilFFTs.PencilArrays.get_timer-Tuple{PencilFFTPlan}"><code>PencilFFTs.PencilArrays.get_timer</code></a></li><li><a href="#PencilFFTs.Transforms.is_inplace-Tuple{PencilFFTPlan}"><code>PencilFFTs.Transforms.is_inplace</code></a></li><li><a href="#PencilFFTs.allocate_input"><code>PencilFFTs.allocate_input</code></a></li><li><a href="#PencilFFTs.allocate_output"><code>PencilFFTs.allocate_output</code></a></li><li><a href="#PencilFFTs.get_scale_factor-Tuple{PencilFFTPlan}"><code>PencilFFTs.get_scale_factor</code></a></li></ul></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../examples/gradient/">« Gradient of a scalar field</a><a class="docs-footer-nextpage" href="../Transforms/">Available transforms »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Sunday 17 May 2020 14:44">Sunday 17 May 2020</span>. Using Julia version 1.4.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
