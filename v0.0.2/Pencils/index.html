<!DOCTYPE html><HTML lang="en"><head><meta charset="UTF-8"/><meta content="width=device-width, initial-scale=1.0" name="viewport"/><title>MPI-distributed data · PencilFFTs.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script data-main="../assets/documenter.js" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link href="../assets/custom.css" rel="stylesheet" type="text/css"/><link class="docs-theme-link" data-theme-name="documenter-dark" href="../assets/themes/documenter-dark.css" rel="stylesheet" type="text/css"/><link class="docs-theme-link" data-theme-name="documenter-light" data-theme-primary="" href="../assets/themes/documenter-light.css" rel="stylesheet" type="text/css"/><script src="../assets/themeswap.js"></script><script data-outdated-warner="">function maybeAddWarning () {
    const head = document.getElementsByTagName('head')[0];

    // Add a noindex meta tag (unless one exists) so that search engines don't index this version of the docs.
    if (document.body.querySelector('meta[name="robots"]') === null) {
        const meta = document.createElement('meta');
        meta.name = 'robots';
        meta.content = 'noindex';

        head.appendChild(meta);
    };

    // Add a stylesheet to avoid inline styling
    const style = document.createElement('style');
    style.type = 'text/css';
    style.appendChild(document.createTextNode('.outdated-warning-overlay {  position: fixed;  top: 0;  left: 0;  right: 0;  box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);  z-index: 999;  background-color: #ffaba7;  color: rgba(0, 0, 0, 0.7);  border-bottom: 3px solid #da0b00;  padding: 10px 35px;  text-align: center;  font-size: 15px; }  .outdated-warning-overlay .outdated-warning-closer {    position: absolute;    top: calc(50% - 10px);    right: 18px;    cursor: pointer;    width: 12px; }  .outdated-warning-overlay a {    color: #2e63b8; }    .outdated-warning-overlay a:hover {      color: #363636; }'));
    head.appendChild(style);

    const div = document.createElement('div');
    div.classList.add('outdated-warning-overlay');
    const closer = document.createElement('div');
    closer.classList.add('outdated-warning-closer');

    // Icon by font-awesome (license: https://fontawesome.com/license, link: https://fontawesome.com/icons/times?style=solid)
    closer.innerHTML = '<svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="times" class="svg-inline--fa fa-times fa-w-11" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 352 512"><path fill="currentColor" d="M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"></path></svg>';
    closer.addEventListener('click', function () {
        document.body.removeChild(div);
    });
    let href = '/stable';
    if (window.documenterBaseURL) {
        href = window.documenterBaseURL + '/../stable';
    }
    div.innerHTML = 'This is an old version of the documentation. <br> <a href="' + href + '">Go to the newest version</a>.';
    div.appendChild(closer);
    document.body.appendChild(div);
};

if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', maybeAddWarning);
} else {
    maybeAddWarning();
};
</script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">PencilFFTs.jl</span></div><form action="../search/" class="docs-search"><input class="docs-search-query" id="documenter-search-query" name="q" placeholder="Search docs" type="text"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../PencilFFTs/">Distributed FFTs</a></li><li><a class="tocitem" href="../Transforms/">Available transforms</a></li><li class="is-active"><a class="tocitem" href="">MPI-distributed data</a><ul class="internal"><li><a class="tocitem" href="#sec:mpi_topology-1"><span>MPI topology</span></a></li><li><a class="tocitem" href="#sec:pencil_configs-1"><span>Pencil configurations</span></a></li><li><a class="tocitem" href="#Array-wrappers-1"><span>Array wrappers</span></a></li><li><a class="tocitem" href="#Global-MPI-operations-1"><span>Global MPI operations</span></a></li><li><a class="tocitem" href="#Pencils.measuring_performance-1"><span>Measuring performance</span></a></li><li><a class="tocitem" href="#Index-1"><span>Index</span></a></li></ul></li><li><a class="tocitem" href="../benchmarks/">Benchmarks</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href="">MPI-distributed data</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="">MPI-distributed data</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/jipolanco/PencilFFTs.jl/blob/master/docs/src/Pencils.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" href="#" id="documenter-settings-button" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" href="#" id="documenter-sidebar-button"></a></div></header><article class="content" id="documenter-page"><h1 id="Pencils_module-1"><a class="docs-heading-anchor" href="#Pencils_module-1">MPI-distributed data</a><a class="docs-heading-anchor-permalink" href="#Pencils_module-1" title="Permalink"></a></h1><p>The distribution of global data among MPI processes is managed by the <a href="#PencilFFTs.Pencils"><code>Pencils</code></a> module. This module may be used independently of the FFT functionality.</p><p>The <a href="#PencilFFTs.Pencils"><code>Pencils</code></a> module defines types that describe <a href="#sec:mpi_topology-1">an MPI Cartesian topology</a> and <a href="#sec:pencil_configs-1">the decomposition of data over MPI processes</a>. Also, <a href="#Array-wrappers-1">array wrappers</a> allow to conveniently (and efficiently) deal with the MPI-decomposed data.</p><article class="docstring"><header><a class="docstring-binding" href="#PencilFFTs.Pencils" id="PencilFFTs.Pencils"><code>PencilFFTs.Pencils</code></a> — <span class="docstring-category">Module</span></header><section><div><p>Module for multidimensional data decomposition using MPI.</p><p>Handles different decomposition configurations and data transpositions between them. Also defines relevant data structures for handling distributed data.</p></div><a class="docs-sourcelink" href="https://github.com/jipolanco/PencilFFTs.jl/blob/67d44c6d9b10ed8c65129fb63e56c03cbff3acd6/src/Pencils/Pencils.jl#L1-L6" target="_blank">source</a></section></article><h2 id="sec:mpi_topology-1"><a class="docs-heading-anchor" href="#sec:mpi_topology-1">MPI topology</a><a class="docs-heading-anchor-permalink" href="#sec:mpi_topology-1" title="Permalink"></a></h2><p>The <a href="#PencilFFTs.Pencils.MPITopologies.MPITopology"><code>MPITopology</code></a> type defines the MPI Cartesian topology of the decomposition. In other words, it contains information about the number of decomposed dimensions, and the number of processes in each of these dimensions.</p><p>At the lower level, <a href="#PencilFFTs.Pencils.MPITopologies.MPITopology"><code>MPITopology</code></a> uses <a href="https://www.mpich.org/static/docs/latest/www3/MPI_Cart_create.html"><code>MPI_Cart_create</code></a> to define a Cartesian MPI communicator.</p><article class="docstring"><header><a class="docstring-binding" href="#PencilFFTs.Pencils.MPITopologies.MPITopology" id="PencilFFTs.Pencils.MPITopologies.MPITopology"><code>PencilFFTs.Pencils.MPITopologies.MPITopology</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia">MPITopology{N}</code></pre><p>Describes an N-dimensional Cartesian MPI decomposition topology.</p><hr/><pre><code class="language-none">MPITopology(comm::MPI.Comm, pdims::Dims{N}) where N</code></pre><p>Create N-dimensional MPI topology information.</p><p>The <code>pdims</code> tuple specifies the number of MPI processes to put in every dimension of the topology. The product of its values must be equal to the number of processes in communicator <code>comm</code>.</p><p><strong>Example</strong></p><pre><code class="language-julia"># Divide 2D topology into 4×2 blocks.
comm = MPI.COMM_WORLD
@assert MPI.Comm_size(comm) == 8
topology = MPITopology(comm, (4, 2))</code></pre><hr/><pre><code class="language-none">MPITopology{N}(comm_cart::MPI.Comm) where N</code></pre><p>Create topology information from MPI communicator with Cartesian topology (typically constructed using <code>MPI.Cart_create</code>). The topology must have dimension <code>N</code>.</p></div><a class="docs-sourcelink" href="https://github.com/jipolanco/PencilFFTs.jl/blob/67d44c6d9b10ed8c65129fb63e56c03cbff3acd6/src/Pencils/MPITopologies.jl#L9-L41" target="_blank">source</a></section></article><article class="docstring"><header><a class="docstring-binding" href="#PencilFFTs.Pencils.MPITopologies.get_comm-Tuple{MPITopology}" id="PencilFFTs.Pencils.MPITopologies.get_comm-Tuple{MPITopology}"><code>PencilFFTs.Pencils.MPITopologies.get_comm</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">get_comm(t::MPITopology)</code></pre><p>Get MPI communicator associated to an MPI Cartesian topology.</p></div><a class="docs-sourcelink" href="https://github.com/jipolanco/PencilFFTs.jl/blob/67d44c6d9b10ed8c65129fb63e56c03cbff3acd6/src/Pencils/MPITopologies.jl#L129-L133" target="_blank">source</a></section></article><article class="docstring"><header><a class="docstring-binding" href="#Base.length-Tuple{MPITopology}" id="Base.length-Tuple{MPITopology}"><code>Base.length</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">length(t::MPITopology)</code></pre><p>Get total size of Cartesian topology (i.e. total number of MPI processes).</p></div><a class="docs-sourcelink" href="https://github.com/jipolanco/PencilFFTs.jl/blob/67d44c6d9b10ed8c65129fb63e56c03cbff3acd6/src/Pencils/MPITopologies.jl#L122-L126" target="_blank">source</a></section></article><article class="docstring"><header><a class="docstring-binding" href="#Base.ndims-Tuple{MPITopology}" id="Base.ndims-Tuple{MPITopology}"><code>Base.ndims</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">ndims(p::Pencil)</code></pre><p>Number of spatial dimensions associated to pencil data.</p><p>This corresponds to the total number of dimensions of the space, which includes the decomposed and non-decomposed dimensions.</p></div><a class="docs-sourcelink" href="https://github.com/jipolanco/PencilFFTs.jl/blob/67d44c6d9b10ed8c65129fb63e56c03cbff3acd6/src/Pencils/pencil.jl#L171-L178" target="_blank">source</a></section><section><div><pre><code class="language-none">ndims(t::MPITopology)</code></pre><p>Get dimensionality of Cartesian topology.</p></div><a class="docs-sourcelink" href="https://github.com/jipolanco/PencilFFTs.jl/blob/67d44c6d9b10ed8c65129fb63e56c03cbff3acd6/src/Pencils/MPITopologies.jl#L108-L112" target="_blank">source</a></section></article><article class="docstring"><header><a class="docstring-binding" href="#Base.size-Tuple{MPITopology}" id="Base.size-Tuple{MPITopology}"><code>Base.size</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">size(t::MPITopology)</code></pre><p>Get dimensions of Cartesian topology.</p></div><a class="docs-sourcelink" href="https://github.com/jipolanco/PencilFFTs.jl/blob/67d44c6d9b10ed8c65129fb63e56c03cbff3acd6/src/Pencils/MPITopologies.jl#L115-L119" target="_blank">source</a></section></article><h2 id="sec:pencil_configs-1"><a class="docs-heading-anchor" href="#sec:pencil_configs-1">Pencil configurations</a><a class="docs-heading-anchor-permalink" href="#sec:pencil_configs-1" title="Permalink"></a></h2><p>The <a href="#PencilFFTs.Pencils.Pencil"><code>Pencil</code></a> type describes a given MPI decomposition configuration of multidimensional data.</p><article class="docstring"><header><a class="docstring-binding" href="#PencilFFTs.Pencils.Pencil" id="PencilFFTs.Pencils.Pencil"><code>PencilFFTs.Pencils.Pencil</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia">Pencil{N,M,T}</code></pre><p>Describes the decomposition of an <code>N</code>-dimensional Cartesian geometry among MPI processes along <code>M</code> directions (with <code>M &lt; N</code>).</p><p>The <code>Pencil</code> describes the decomposition of arrays of element type <code>T</code>.</p><hr/><pre><code class="language-none">Pencil(topology::MPITopology{M}, size_global::Dims{N},
       decomp_dims::Dims{M}, [element_type=Float64];
       permute::Union{Nothing, Val}=nothing,
       timer=TimerOutput())</code></pre><p>Define the decomposition of an <code>N</code>-dimensional geometry along <code>M</code> dimensions.</p><p>The dimensions of the geometry are given by <code>size_global = (N1, N2, ...)</code>. The <code>Pencil</code> describes the decomposition of an array of dimensions <code>size_global</code> and type <code>T</code> across a group of MPI processes.</p><p>Data is distributed over the given <code>M</code>-dimensional MPI topology (with <code>M &lt; N</code>). The decomposed dimensions are given by <code>decomp_dims</code>.</p><p>The optional parameter <code>perm</code> should be a (compile-time) tuple defining a permutation of the data indices. Such permutation may be useful for performance reasons, since it may be preferable (e.g. for FFTs) that the data is contiguous along the pencil direction.</p><p>It is also possible to pass a <code>TimerOutput</code> to the constructor. See <a href="#Pencils.measuring_performance-1">Measuring performance</a> for details.</p><p><strong>Examples</strong></p><p>Decompose a 3D geometry of global dimensions <span>$N_x × N_y × N_z = 4×8×12$</span> along the second (<span>$y$</span>) and third (<span>$z$</span>) dimensions.</p><pre><code class="language-julia">Pencil(topology, (4, 8, 12), (2, 3))                          # data is in (x, y, z) order
Pencil(topology, (4, 8, 12), (2, 3), permute=Val((3, 2, 1)))  # data is in (z, y, x) order</code></pre><p>In the second case, the actual data is stored in <code>(z, y, x)</code> order within each MPI process.</p><hr/><pre><code class="language-none">Pencil(p::Pencil{N,M}, [element_type=eltype(p)];
       decomp_dims::Dims{M}=get_decomposition(p),
       size_global::Dims{N}=size_global(p),
       permute::P=get_permutation(p),
       timer::TimerOutput=get_timer(p))</code></pre><p>Create new pencil configuration from an existent one.</p><p>This constructor enables sharing temporary data buffers between the two pencil configurations, leading to reduced global memory usage.</p></div><a class="docs-sourcelink" href="https://github.com/jipolanco/PencilFFTs.jl/blob/67d44c6d9b10ed8c65129fb63e56c03cbff3acd6/src/Pencils/pencil.jl#L1-L56" target="_blank">source</a></section></article><h3 id="Functions-1"><a class="docs-heading-anchor" href="#Functions-1">Functions</a><a class="docs-heading-anchor-permalink" href="#Functions-1" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-binding" href="#Base.eltype-Tuple{Pencil}" id="Base.eltype-Tuple{Pencil}"><code>Base.eltype</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">eltype(p::Pencil)</code></pre><p>Element type associated to the given pencil.</p></div><a class="docs-sourcelink" href="https://github.com/jipolanco/PencilFFTs.jl/blob/67d44c6d9b10ed8c65129fb63e56c03cbff3acd6/src/Pencils/pencil.jl#L155-L159" target="_blank">source</a></section></article><article class="docstring"><header><a class="docstring-binding" href="#PencilFFTs.Pencils.MPITopologies.get_comm-Tuple{Pencil}" id="PencilFFTs.Pencils.MPITopologies.get_comm-Tuple{Pencil}"><code>PencilFFTs.Pencils.MPITopologies.get_comm</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">get_comm(p::Pencil)</code></pre><p>Get MPI communicator associated to an MPI decomposition scheme.</p></div><a class="docs-sourcelink" href="https://github.com/jipolanco/PencilFFTs.jl/blob/67d44c6d9b10ed8c65129fb63e56c03cbff3acd6/src/Pencils/pencil.jl#L181-L185" target="_blank">source</a></section></article><article class="docstring"><header><a class="docstring-binding" href="#PencilFFTs.Pencils.get_decomposition-Tuple{Pencil}" id="PencilFFTs.Pencils.get_decomposition-Tuple{Pencil}"><code>PencilFFTs.Pencils.get_decomposition</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">get_decomposition(p::Pencil)</code></pre><p>Get tuple with decomposed dimensions of the given pencil configuration.</p></div><a class="docs-sourcelink" href="https://github.com/jipolanco/PencilFFTs.jl/blob/67d44c6d9b10ed8c65129fb63e56c03cbff3acd6/src/Pencils/pencil.jl#L197-L201" target="_blank">source</a></section></article><article class="docstring"><header><a class="docstring-binding" href="#PencilFFTs.Pencils.get_permutation-Tuple{Pencil}" id="PencilFFTs.Pencils.get_permutation-Tuple{Pencil}"><code>PencilFFTs.Pencils.get_permutation</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">get_permutation(p::Pencil)</code></pre><p>Get index permutation associated to the given pencil configuration.</p><p>Returns <code>nothing</code> if there is no associated permutation.</p></div><a class="docs-sourcelink" href="https://github.com/jipolanco/PencilFFTs.jl/blob/67d44c6d9b10ed8c65129fb63e56c03cbff3acd6/src/Pencils/pencil.jl#L188-L194" target="_blank">source</a></section></article><article class="docstring"><header><a class="docstring-binding" href="#Base.ndims-Tuple{Pencil}" id="Base.ndims-Tuple{Pencil}"><code>Base.ndims</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">ndims(p::Pencil)</code></pre><p>Number of spatial dimensions associated to pencil data.</p><p>This corresponds to the total number of dimensions of the space, which includes the decomposed and non-decomposed dimensions.</p></div><a class="docs-sourcelink" href="https://github.com/jipolanco/PencilFFTs.jl/blob/67d44c6d9b10ed8c65129fb63e56c03cbff3acd6/src/Pencils/pencil.jl#L171-L178" target="_blank">source</a></section><section><div><pre><code class="language-none">ndims(t::MPITopology)</code></pre><p>Get dimensionality of Cartesian topology.</p></div><a class="docs-sourcelink" href="https://github.com/jipolanco/PencilFFTs.jl/blob/67d44c6d9b10ed8c65129fb63e56c03cbff3acd6/src/Pencils/MPITopologies.jl#L108-L112" target="_blank">source</a></section></article><article class="docstring"><header><a class="docstring-binding" href="#PencilFFTs.Pencils.range_local-Union{Tuple{Pencil{N,M,T,P} where P where T&lt;:Number where M}, Tuple{N}} where N" id="PencilFFTs.Pencils.range_local-Union{Tuple{Pencil{N,M,T,P} where P where T&lt;:Number where M}, Tuple{N}} where N"><code>PencilFFTs.Pencils.range_local</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">range_local(p::Pencil; permute=true)</code></pre><p>Local data range held by the pencil.</p><p>By default the dimensions are permuted to match those of the associated data arrays.</p></div><a class="docs-sourcelink" href="https://github.com/jipolanco/PencilFFTs.jl/blob/67d44c6d9b10ed8c65129fb63e56c03cbff3acd6/src/Pencils/pencil.jl#L204-L211" target="_blank">source</a></section></article><article class="docstring"><header><a class="docstring-binding" href="#PencilFFTs.Pencils.size_global-Tuple{Pencil}" id="PencilFFTs.Pencils.size_global-Tuple{Pencil}"><code>PencilFFTs.Pencils.size_global</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">size_global(p::Pencil; permute=false)</code></pre><p>Global dimensions of the Cartesian grid associated to the given domain decomposition.</p><p>Unlike <code>size_local</code>, by default the returned dimensions are <em>not</em> permuted to match the dimensions of the local data.</p></div><a class="docs-sourcelink" href="https://github.com/jipolanco/PencilFFTs.jl/blob/67d44c6d9b10ed8c65129fb63e56c03cbff3acd6/src/Pencils/pencil.jl#L226-L234" target="_blank">source</a></section></article><article class="docstring"><header><a class="docstring-binding" href="#PencilFFTs.Pencils.size_local-Tuple{Pencil}" id="PencilFFTs.Pencils.size_local-Tuple{Pencil}"><code>PencilFFTs.Pencils.size_local</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">size_local(p::Pencil; permute=true)</code></pre><p>Local dimensions of the data held by the pencil.</p><p>By default the dimensions are permuted to match those of the associated data arrays.</p></div><a class="docs-sourcelink" href="https://github.com/jipolanco/PencilFFTs.jl/blob/67d44c6d9b10ed8c65129fb63e56c03cbff3acd6/src/Pencils/pencil.jl#L215-L222" target="_blank">source</a></section></article><article class="docstring"><header><a class="docstring-binding" href="#PencilFFTs.Pencils.to_local-Tuple{Pencil}" id="PencilFFTs.Pencils.to_local-Tuple{Pencil}"><code>PencilFFTs.Pencils.to_local</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">to_local(p::Pencil, global_inds; permute=true)</code></pre><p>Convert non-permuted global indices to local indices.</p><p>Indices are permuted by default using the permutation associated to the pencil configuration <code>p</code>.</p></div><a class="docs-sourcelink" href="https://github.com/jipolanco/PencilFFTs.jl/blob/67d44c6d9b10ed8c65129fb63e56c03cbff3acd6/src/Pencils/pencil.jl#L238-L245" target="_blank">source</a></section></article><h2 id="Array-wrappers-1"><a class="docs-heading-anchor" href="#Array-wrappers-1">Array wrappers</a><a class="docs-heading-anchor-permalink" href="#Array-wrappers-1" title="Permalink"></a></h2><p><strong>TODO</strong> add description</p><article class="docstring"><header><a class="docstring-binding" href="#PencilFFTs.Pencils.PencilArray" id="PencilFFTs.Pencils.PencilArray"><code>PencilFFTs.Pencils.PencilArray</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia">PencilArray(pencil::Pencil, data::AbstractArray{T,N})</code></pre><p>Create array wrapper with pencil decomposition information.</p><p>The array dimensions and element type must be consistent with those of the given pencil.</p><div class="admonition is-info"><header class="admonition-header">Index permutations</header><div class="admonition-body"><p>If the <code>Pencil</code> has an associated index permutation, then the input array must have its dimensions permuted accordingly. The resulting <code>PencilArray</code> must be accessed with permuted indices, just like its parent array.</p><h5>Example</h5><p>Suppose <code>pencil</code> has local dimensions <code>(10, 20, 30)</code> before permutation, and has an asociated permutation <code>(2, 3, 1)</code>. Then:</p><pre><code class="language-julia">data = zeros(20, 30, 10)       # parent array (with permuted dimensions)
u = PencilArray(pencil, data)  # wrapper with dimensions (10, 20, 30)
u[5, 15, 25]                   # BoundsError (25 &gt; 10)
u[15, 25, 5]                   # correct
parent(u)[15, 25, 5]           # correct</code></pre></div></div><div class="admonition is-info"><header class="admonition-header">Extra dimensions</header><div class="admonition-body"><p>The data array can have one or more extra dimensions to the right (slow indices). For instance, these may correspond to vector or tensor components. These dimensions are not affected by permutations.</p><h5>Example</h5><pre><code class="language-julia">dims = (20, 30, 10)
PencilArray(pencil, zeros(dims...))        # works (scalar)
PencilArray(pencil, zeros(dims..., 3))     # works (3-component vector)
PencilArray(pencil, zeros(dims..., 4, 3))  # works (4×3 tensor)
PencilArray(pencil, zeros(3, dims...))     # fails</code></pre></div></div><hr/><pre><code class="language-none">PencilArray(pencil::Pencil, [extra_dims=()])</code></pre><p>Allocate uninitialised <code>PencilArray</code> that can hold data in the local pencil.</p><p>Extra dimensions, for instance representing vector components, can be specified. These dimensions are added to the rightmost (slowest) indices of the resulting array.</p><p><strong>Example</strong></p><p>Suppose <code>pencil</code> has local dimensions <code>(20, 10, 30)</code> after permutation. Then:</p><pre><code class="language-julia">PencilArray(pencil)          # array dimensions are (20, 10, 30)
PencilArray(pencil, (4, 3))  # array dimensions are (20, 10, 30, 4, 3)</code></pre></div><a class="docs-sourcelink" href="https://github.com/jipolanco/PencilFFTs.jl/blob/67d44c6d9b10ed8c65129fb63e56c03cbff3acd6/src/Pencils/arrays.jl#L1-L62" target="_blank">source</a></section></article><h3 id="Functions-2"><a class="docs-heading-anchor" href="#Functions-2">Functions</a><a class="docs-heading-anchor-permalink" href="#Functions-2" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-binding" href="#PencilFFTs.Pencils.extra_dims-Tuple{PencilArray}" id="PencilFFTs.Pencils.extra_dims-Tuple{PencilArray}"><code>PencilFFTs.Pencils.extra_dims</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">extra_dims(x::PencilArray)</code></pre><p>Return tuple with size of "extra" dimensions of <code>PencilArray</code>.</p></div><a class="docs-sourcelink" href="https://github.com/jipolanco/PencilFFTs.jl/blob/67d44c6d9b10ed8c65129fb63e56c03cbff3acd6/src/Pencils/arrays.jl#L161-L165" target="_blank">source</a></section></article><article class="docstring"><header><a class="docstring-binding" href="#PencilFFTs.Pencils.MPITopologies.get_comm-Tuple{PencilArray}" id="PencilFFTs.Pencils.MPITopologies.get_comm-Tuple{PencilArray}"><code>PencilFFTs.Pencils.MPITopologies.get_comm</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">get_comm(x::PencilArray)</code></pre><p>Get MPI communicator associated to a pencil-distributed array.</p></div><a class="docs-sourcelink" href="https://github.com/jipolanco/PencilFFTs.jl/blob/67d44c6d9b10ed8c65129fb63e56c03cbff3acd6/src/Pencils/arrays.jl#L190-L194" target="_blank">source</a></section></article><article class="docstring"><header><a class="docstring-binding" href="#PencilFFTs.Pencils.get_permutation-Tuple{PencilArray}" id="PencilFFTs.Pencils.get_permutation-Tuple{PencilArray}"><code>PencilFFTs.Pencils.get_permutation</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">get_permutation(x::PencilArray)</code></pre><p>Get index permutation associated to the given <code>PencilArray</code>.</p><p>Returns <code>nothing</code> if there is no associated permutation.</p></div><a class="docs-sourcelink" href="https://github.com/jipolanco/PencilFFTs.jl/blob/67d44c6d9b10ed8c65129fb63e56c03cbff3acd6/src/Pencils/arrays.jl#L197-L203" target="_blank">source</a></section></article><article class="docstring"><header><a class="docstring-binding" href="#PencilFFTs.Pencils.global_view-Tuple{PencilArray}" id="PencilFFTs.Pencils.global_view-Tuple{PencilArray}"><code>PencilFFTs.Pencils.global_view</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">global_view(x::PencilArray)</code></pre><p>Create an <a href="https://github.com/JuliaArrays/OffsetArrays.jl"><code>OffsetArray</code></a> of a <code>PencilArray</code> that takes global permuted indices.</p></div><a class="docs-sourcelink" href="https://github.com/jipolanco/PencilFFTs.jl/blob/67d44c6d9b10ed8c65129fb63e56c03cbff3acd6/src/Pencils/global_view.jl#L5-L10" target="_blank">source</a></section></article><article class="docstring"><header><a class="docstring-binding" href="#PencilFFTs.Pencils.ndims_extra-Tuple{PencilArray}" id="PencilFFTs.Pencils.ndims_extra-Tuple{PencilArray}"><code>PencilFFTs.Pencils.ndims_extra</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">ndims_extra(x::PencilArray)</code></pre><p>Number of "extra" dimensions associated to <code>PencilArray</code>.</p><p>These are the dimensions that are not associated to the domain geometry. For instance, they may correspond to vector or tensor components.</p><p>These dimensions correspond to the rightmost indices of the array.</p><p>The total number of dimensions of a <code>PencilArray</code> is given by:</p><pre><code class="language-none">ndims(x) == ndims_space(x) + ndims_extra(x)</code></pre></div><a class="docs-sourcelink" href="https://github.com/jipolanco/PencilFFTs.jl/blob/67d44c6d9b10ed8c65129fb63e56c03cbff3acd6/src/Pencils/arrays.jl#L130-L144" target="_blank">source</a></section></article><article class="docstring"><header><a class="docstring-binding" href="#PencilFFTs.Pencils.ndims_space-Tuple{PencilArray}" id="PencilFFTs.Pencils.ndims_space-Tuple{PencilArray}"><code>PencilFFTs.Pencils.ndims_space</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">ndims_space(x::PencilArray)</code></pre><p>Number of dimensions associated to the domain geometry.</p><p>These dimensions correspond to the leftmost indices of the array.</p><p>The total number of dimensions of a <code>PencilArray</code> is given by:</p><pre><code class="language-none">ndims(x) == ndims_space(x) + ndims_extra(x)</code></pre></div><a class="docs-sourcelink" href="https://github.com/jipolanco/PencilFFTs.jl/blob/67d44c6d9b10ed8c65129fb63e56c03cbff3acd6/src/Pencils/arrays.jl#L147-L158" target="_blank">source</a></section></article><article class="docstring"><header><a class="docstring-binding" href="#Base.parent-Tuple{PencilArray}" id="Base.parent-Tuple{PencilArray}"><code>Base.parent</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">parent(x::PencilArray)</code></pre><p>Return array wrapped by a <code>PencilArray</code>.</p></div><a class="docs-sourcelink" href="https://github.com/jipolanco/PencilFFTs.jl/blob/67d44c6d9b10ed8c65129fb63e56c03cbff3acd6/src/Pencils/arrays.jl#L123-L127" target="_blank">source</a></section></article><article class="docstring"><header><a class="docstring-binding" href="#PencilFFTs.Pencils.pencil-Tuple{PencilArray}" id="PencilFFTs.Pencils.pencil-Tuple{PencilArray}"><code>PencilFFTs.Pencils.pencil</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">pencil(x::PencilArray)</code></pre><p>Return decomposition configuration associated to the <code>PencilArray</code>.</p></div><a class="docs-sourcelink" href="https://github.com/jipolanco/PencilFFTs.jl/blob/67d44c6d9b10ed8c65129fb63e56c03cbff3acd6/src/Pencils/arrays.jl#L116-L120" target="_blank">source</a></section></article><article class="docstring"><header><a class="docstring-binding" href="#PencilFFTs.Pencils.range_local-Tuple{PencilArray}" id="PencilFFTs.Pencils.range_local-Tuple{PencilArray}"><code>PencilFFTs.Pencils.range_local</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">range_local(x::PencilArray; permute=true)</code></pre><p>Local data range held by the PencilArray.</p><p>By default the dimensions are permuted to match the order of indices in the array.</p></div><a class="docs-sourcelink" href="https://github.com/jipolanco/PencilFFTs.jl/blob/67d44c6d9b10ed8c65129fb63e56c03cbff3acd6/src/Pencils/arrays.jl#L179-L186" target="_blank">source</a></section></article><article class="docstring"><header><a class="docstring-binding" href="#Base.size-Tuple{PencilArray}" id="Base.size-Tuple{PencilArray}"><code>Base.size</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">size(x::PencilArray)</code></pre><p>Return local dimensions of a <code>PencilArray</code>.</p></div><a class="docs-sourcelink" href="https://github.com/jipolanco/PencilFFTs.jl/blob/67d44c6d9b10ed8c65129fb63e56c03cbff3acd6/src/Pencils/arrays.jl#L98-L102" target="_blank">source</a></section></article><article class="docstring"><header><a class="docstring-binding" href="#PencilFFTs.Pencils.size_global-Tuple{PencilArray}" id="PencilFFTs.Pencils.size_global-Tuple{PencilArray}"><code>PencilFFTs.Pencils.size_global</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">size_global(x::PencilArray; permute=false)</code></pre><p>Global dimensions associated to the given array.</p><p>Unlike <code>size</code>, by default the returned dimensions are <em>not</em> permuted according to the associated pencil configuration.</p></div><a class="docs-sourcelink" href="https://github.com/jipolanco/PencilFFTs.jl/blob/67d44c6d9b10ed8c65129fb63e56c03cbff3acd6/src/Pencils/arrays.jl#L168-L175" target="_blank">source</a></section></article><article class="docstring"><header><a class="docstring-binding" href="#PencilFFTs.Pencils.spatial_indices-Tuple{PencilArray}" id="PencilFFTs.Pencils.spatial_indices-Tuple{PencilArray}"><code>PencilFFTs.Pencils.spatial_indices</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">spatial_indices(x::PencilArray)
spatial_indices(x::GlobalPencilArray)</code></pre><p>Create a <code>CartesianIndices</code> to iterate over the local "spatial" dimensions of a pencil-decomposed array.</p><p>The "spatial" dimensions are those that may be decomposed (as opposed to the "extra" dimensions, which are not considered by this function).</p></div><a class="docs-sourcelink" href="https://github.com/jipolanco/PencilFFTs.jl/blob/67d44c6d9b10ed8c65129fb63e56c03cbff3acd6/src/Pencils/arrays.jl#L206-L215" target="_blank">source</a></section></article><h2 id="Global-MPI-operations-1"><a class="docs-heading-anchor" href="#Global-MPI-operations-1">Global MPI operations</a><a class="docs-heading-anchor-permalink" href="#Global-MPI-operations-1" title="Permalink"></a></h2><p>One of the most time-consuming parts of a large-scale computation involving multidimensional FFTs, is the global data transpositions between different MPI decomposition configurations. In <code>Pencils</code>, this is performed by the <a href="#LinearAlgebra.transpose!"><code>transpose!</code></a> function, which takes two <code>PencilArray</code>s, typically associated to two different configurations. The implementation performs comparably to similar implementations in lower-level languages (see <a href="../benchmarks/#Benchmarks-1">Benchmarks</a>).</p><p>Also provided is a <a href="#PencilFFTs.Pencils.gather"><code>gather</code></a> function that creates a single global array from decomposed data. This can be useful for tests (in fact, it is used in the <code>Pencils</code> tests to verify the correctness of the transpositions), but shouldn't be used with large datasets. It is generally useful for small problems where the global size of the data can easily fit the locally available memory.</p><article class="docstring"><header><a class="docstring-binding" href="#LinearAlgebra.transpose!" id="LinearAlgebra.transpose!"><code>LinearAlgebra.transpose!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">transpose!(dest::PencilArray{T,N}, src::PencilArray{T,N};
           method=TransposeMethods.IsendIrecv())</code></pre><p>Transpose data from one pencil configuration to the other.</p><p>The two pencil configurations must be compatible for transposition:</p><ul><li><p>they must share the same MPI Cartesian topology,</p></li><li><p>they must have the same global data size,</p></li><li><p>when written as a sorted tuple, the decomposed dimensions must be almost the same, with at most one difference. For instance, if the input of a 3D dataset is decomposed in <code>(2, 3)</code>, then the output may be decomposed in <code>(1, 3)</code>, but not in <code>(1, 2)</code>. If the decomposed dimensions are the same, then no transposition is performed, and data is just copied if needed.</p></li></ul><p><strong>Performance tuning</strong></p><p>The <code>method</code> argument allows to choose between transposition implementations. This can be useful to tune performance of MPI data transfers. Two values are currently accepted:</p><ul><li><p><code>TransposeMethods.IsendIrecv()</code> uses non-blocking point-to-point data transfers (<code>MPI_Isend</code> and <code>MPI_Irecv</code>). This may be more performant since data transfers are interleaved with local data transpositions (index permutation of received data). This is the default.</p></li><li><p><code>TransposeMethods.Alltoallv()</code> uses <code>MPI_Alltoallv</code> for global data transpositions.</p></li></ul></div><a class="docs-sourcelink" href="https://github.com/jipolanco/PencilFFTs.jl/blob/67d44c6d9b10ed8c65129fb63e56c03cbff3acd6/src/Pencils/transpose.jl#L15-L48" target="_blank">source</a></section></article><article class="docstring"><header><a class="docstring-binding" href="#PencilFFTs.Pencils.gather" id="PencilFFTs.Pencils.gather"><code>PencilFFTs.Pencils.gather</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">gather(x::PencilArray, [root::Integer=0])</code></pre><p>Gather data from all MPI processes into one (big) array.</p><p>Data is received by the <code>root</code> process.</p><p>Returns the full array on the <code>root</code> process, and <code>nothing</code> on the other processes.</p><p>This can be useful for testing, but it shouldn't be used with very large datasets!</p></div><a class="docs-sourcelink" href="https://github.com/jipolanco/PencilFFTs.jl/blob/67d44c6d9b10ed8c65129fb63e56c03cbff3acd6/src/Pencils/arrays.jl#L221-L233" target="_blank">source</a></section></article><h2 id="Pencils.measuring_performance-1"><a class="docs-heading-anchor" href="#Pencils.measuring_performance-1">Measuring performance</a><a class="docs-heading-anchor-permalink" href="#Pencils.measuring_performance-1" title="Permalink"></a></h2><p>It is possible to measure the time spent in different sections of the MPI data transposition routines using the <a href="https://github.com/KristofferC/TimerOutputs.jl">TimerOutputs</a> package. This has a (very small) performance overhead, so it is disabled by default. To enable time measurements, call <code>TimerOutputs.enable_debug_timings(PencilFFTs.Pencils)</code> after loading <code>PencilFFTs</code>. For more details see the <a href="https://github.com/KristofferC/TimerOutputs.jl#overhead">TimerOutputs docs</a>.</p><p>Minimal example:</p><pre><code class="language-julia">using MPI
using PencilFFTs.Pencils
using TimerOutput

# Enable timing of `Pencils` functions
TimerOutputs.enable_debug_timings(PencilFFTs.Pencils)

MPI.Init()

pencil = Pencil(#= args... =#)

# [do stuff with `pencil`...]

# Retrieve and print timing data associated to `plan`
to = get_timer(pencil)
print_timer(to)</code></pre><p>By default, each <code>Pencil</code> has its own <code>TimerOutput</code>. If you already have a <code>TimerOutput</code>, you can pass it to the <a href="#PencilFFTs.Pencils.Pencil"><code>Pencil</code></a> constructor:</p><pre><code class="language-julia">to = TimerOutput()
pencil = Pencil(..., timer=to)

# [do stuff with `pencil`...]

print_timer(to)</code></pre><h2 id="Index-1"><a class="docs-heading-anchor" href="#Index-1">Index</a><a class="docs-heading-anchor-permalink" href="#Index-1" title="Permalink"></a></h2><h3 id="Modules-1"><a class="docs-heading-anchor" href="#Modules-1">Modules</a><a class="docs-heading-anchor-permalink" href="#Modules-1" title="Permalink"></a></h3><ul><li><a href="#PencilFFTs.Pencils"><code>PencilFFTs.Pencils</code></a></li></ul><h3 id="Types-1"><a class="docs-heading-anchor" href="#Types-1">Types</a><a class="docs-heading-anchor-permalink" href="#Types-1" title="Permalink"></a></h3><ul><li><a href="#PencilFFTs.Pencils.MPITopologies.MPITopology"><code>PencilFFTs.Pencils.MPITopologies.MPITopology</code></a></li><li><a href="#PencilFFTs.Pencils.Pencil"><code>PencilFFTs.Pencils.Pencil</code></a></li><li><a href="#PencilFFTs.Pencils.PencilArray"><code>PencilFFTs.Pencils.PencilArray</code></a></li></ul><h3 id="Functions-3"><a class="docs-heading-anchor" href="#Functions-3">Functions</a><a class="docs-heading-anchor-permalink" href="#Functions-3" title="Permalink"></a></h3><ul><li><a href="#Base.eltype-Tuple{Pencil}"><code>Base.eltype</code></a></li><li><a href="#Base.length-Tuple{MPITopology}"><code>Base.length</code></a></li><li><a href="#Base.ndims-Tuple{Pencil}"><code>Base.ndims</code></a></li><li><a href="#Base.ndims-Tuple{MPITopology}"><code>Base.ndims</code></a></li><li><a href="#Base.parent-Tuple{PencilArray}"><code>Base.parent</code></a></li><li><a href="#Base.size-Tuple{MPITopology}"><code>Base.size</code></a></li><li><a href="#Base.size-Tuple{PencilArray}"><code>Base.size</code></a></li><li><a href="#LinearAlgebra.transpose!"><code>LinearAlgebra.transpose!</code></a></li><li><a href="#PencilFFTs.Pencils.MPITopologies.get_comm-Tuple{Pencil}"><code>PencilFFTs.Pencils.MPITopologies.get_comm</code></a></li><li><a href="#PencilFFTs.Pencils.MPITopologies.get_comm-Tuple{PencilArray}"><code>PencilFFTs.Pencils.MPITopologies.get_comm</code></a></li><li><a href="#PencilFFTs.Pencils.MPITopologies.get_comm-Tuple{MPITopology}"><code>PencilFFTs.Pencils.MPITopologies.get_comm</code></a></li><li><a href="#PencilFFTs.Pencils.extra_dims-Tuple{PencilArray}"><code>PencilFFTs.Pencils.extra_dims</code></a></li><li><a href="#PencilFFTs.Pencils.gather"><code>PencilFFTs.Pencils.gather</code></a></li><li><a href="#PencilFFTs.Pencils.get_decomposition-Tuple{Pencil}"><code>PencilFFTs.Pencils.get_decomposition</code></a></li><li><a href="#PencilFFTs.Pencils.get_permutation-Tuple{Pencil}"><code>PencilFFTs.Pencils.get_permutation</code></a></li><li><a href="#PencilFFTs.Pencils.get_permutation-Tuple{PencilArray}"><code>PencilFFTs.Pencils.get_permutation</code></a></li><li><a href="#PencilFFTs.Pencils.global_view-Tuple{PencilArray}"><code>PencilFFTs.Pencils.global_view</code></a></li><li><a href="#PencilFFTs.Pencils.ndims_extra-Tuple{PencilArray}"><code>PencilFFTs.Pencils.ndims_extra</code></a></li><li><a href="#PencilFFTs.Pencils.ndims_space-Tuple{PencilArray}"><code>PencilFFTs.Pencils.ndims_space</code></a></li><li><a href="#PencilFFTs.Pencils.pencil-Tuple{PencilArray}"><code>PencilFFTs.Pencils.pencil</code></a></li><li><a href="#PencilFFTs.Pencils.range_local-Tuple{PencilArray}"><code>PencilFFTs.Pencils.range_local</code></a></li><li><a href="#PencilFFTs.Pencils.range_local-Union{Tuple{Pencil{N,M,T,P} where P where T&lt;:Number where M}, Tuple{N}} where N"><code>PencilFFTs.Pencils.range_local</code></a></li><li><a href="#PencilFFTs.Pencils.size_global-Tuple{PencilArray}"><code>PencilFFTs.Pencils.size_global</code></a></li><li><a href="#PencilFFTs.Pencils.size_global-Tuple{Pencil}"><code>PencilFFTs.Pencils.size_global</code></a></li><li><a href="#PencilFFTs.Pencils.size_local-Tuple{Pencil}"><code>PencilFFTs.Pencils.size_local</code></a></li><li><a href="#PencilFFTs.Pencils.spatial_indices-Tuple{PencilArray}"><code>PencilFFTs.Pencils.spatial_indices</code></a></li><li><a href="#PencilFFTs.Pencils.to_local-Tuple{Pencil}"><code>PencilFFTs.Pencils.to_local</code></a></li></ul></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../Transforms/">« Available transforms</a><a class="docs-footer-nextpage" href="../benchmarks/">Benchmarks »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label></p><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div><p></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Friday 6 December 2019 21:23">Friday 6 December 2019</span>. Using Julia version 1.2.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></HTML>