<!DOCTYPE html><HTML lang="en"><head><meta charset="UTF-8"/><meta content="width=device-width, initial-scale=1.0" name="viewport"/><title>Home · PencilFFTs.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script data-main="assets/documenter.js" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link href="assets/custom.css" rel="stylesheet" type="text/css"/><link class="docs-theme-link" data-theme-name="documenter-dark" href="assets/themes/documenter-dark.css" rel="stylesheet" type="text/css"/><link class="docs-theme-link" data-theme-name="documenter-light" data-theme-primary="" href="assets/themes/documenter-light.css" rel="stylesheet" type="text/css"/><script src="assets/themeswap.js"></script><script data-outdated-warner="">function maybeAddWarning () {
    const head = document.getElementsByTagName('head')[0];

    // Add a noindex meta tag (unless one exists) so that search engines don't index this version of the docs.
    if (document.body.querySelector('meta[name="robots"]') === null) {
        const meta = document.createElement('meta');
        meta.name = 'robots';
        meta.content = 'noindex';

        head.appendChild(meta);
    };

    // Add a stylesheet to avoid inline styling
    const style = document.createElement('style');
    style.type = 'text/css';
    style.appendChild(document.createTextNode('.outdated-warning-overlay {  position: fixed;  top: 0;  left: 0;  right: 0;  box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);  z-index: 999;  background-color: #ffaba7;  color: rgba(0, 0, 0, 0.7);  border-bottom: 3px solid #da0b00;  padding: 10px 35px;  text-align: center;  font-size: 15px; }  .outdated-warning-overlay .outdated-warning-closer {    position: absolute;    top: calc(50% - 10px);    right: 18px;    cursor: pointer;    width: 12px; }  .outdated-warning-overlay a {    color: #2e63b8; }    .outdated-warning-overlay a:hover {      color: #363636; }'));
    head.appendChild(style);

    const div = document.createElement('div');
    div.classList.add('outdated-warning-overlay');
    const closer = document.createElement('div');
    closer.classList.add('outdated-warning-closer');

    // Icon by font-awesome (license: https://fontawesome.com/license, link: https://fontawesome.com/icons/times?style=solid)
    closer.innerHTML = '<svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="times" class="svg-inline--fa fa-times fa-w-11" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 352 512"><path fill="currentColor" d="M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"></path></svg>';
    closer.addEventListener('click', function () {
        document.body.removeChild(div);
    });
    let href = '/stable';
    if (window.documenterBaseURL) {
        href = window.documenterBaseURL + '/../stable';
    }
    div.innerHTML = 'This is an old version of the documentation. <br> <a href="' + href + '">Go to the newest version</a>.';
    div.appendChild(closer);
    document.body.appendChild(div);
};

if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', maybeAddWarning);
} else {
    maybeAddWarning();
};
</script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">PencilFFTs.jl</span></div><form action="search/" class="docs-search"><input class="docs-search-query" id="documenter-search-query" name="q" placeholder="Search docs" type="text"/></form><ul class="docs-menu"><li class="is-active"><a class="tocitem" href="">Home</a><ul class="internal"><li><a class="tocitem" href="#Introduction-1"><span>Introduction</span></a></li><li><a class="tocitem" href="#Getting-started-1"><span>Getting started</span></a></li><li><a class="tocitem" href="#Working-with-MPI-distributed-data-1"><span>Working with MPI-distributed data</span></a></li><li><a class="tocitem" href="#Similar-projects-1"><span>Similar projects</span></a></li></ul></li><li><a class="tocitem" href="PencilFFTs/">Distributed FFTs</a></li><li><a class="tocitem" href="Transforms/">Available transforms</a></li><li><a class="tocitem" href="Pencils/">MPI-distributed data</a></li><li><a class="tocitem" href="benchmarks/">Benchmarks</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href="">Home</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="">Home</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/jipolanco/PencilFFTs.jl/blob/master/docs/src/index.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" href="#" id="documenter-settings-button" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" href="#" id="documenter-sidebar-button"></a></div></header><article class="content" id="documenter-page"><h1 id="PencilFFTs.jl-1"><a class="docs-heading-anchor" href="#PencilFFTs.jl-1">PencilFFTs.jl</a><a class="docs-heading-anchor-permalink" href="#PencilFFTs.jl-1" title="Permalink"></a></h1><p>Fast Fourier transforms of MPI-distributed Julia arrays.</p><h2 id="Introduction-1"><a class="docs-heading-anchor" href="#Introduction-1">Introduction</a><a class="docs-heading-anchor-permalink" href="#Introduction-1" title="Permalink"></a></h2><p>This package provides functionality to distribute multidimensional arrays among MPI processes, and to perform multidimensional FFTs (and related transforms) on them.</p><p>The name of this package originates from the decomposition of 3D domains along two out of three dimensions, sometimes called <em>pencil</em> decomposition. This is illustrated by the figure below (<a href="https://hal.archives-ouvertes.fr/tel-02084215v1">source</a>), where each coloured block is managed by a different MPI process. Typically, one wants to compute FFTs on a scalar or vector field along the three spatial dimensions. In the case of a pencil decomposition, 3D FFTs are performed one dimension at a time (along the non-decomposed direction, using a serial FFT implementation). Global data transpositions are then needed to switch from one pencil configuration to the other and perform FFTs along the other dimensions.</p><div class="figure"><img alt="Pencil decomposition of 3D domains" src="img/pencils.svg"/></div><p>The package is implemented in an efficient generic way that allows to decompose any <code>N</code>-dimensional geometry along <code>M &lt; N</code> dimensions (for the pencil decomposition described above, <code>N = 3</code> and <code>M = 2</code>). Moreover, the transforms applied along each dimension can be arbitrarily chosen among those supported by <code>FFTW</code>, including complex-to-complex, real-to-complex and real-to-real transforms.</p><h2 id="Getting-started-1"><a class="docs-heading-anchor" href="#Getting-started-1">Getting started</a><a class="docs-heading-anchor-permalink" href="#Getting-started-1" title="Permalink"></a></h2><p>Say you want to perform a 3D FFT of real periodic data defined on <span>$N_x × N_y × N_z$</span> grid points. The data is to be distributed over 12 MPI processes on a <span>$3 × 4$</span> grid, as in the figure above.</p><h3 id="Creating-plans-1"><a class="docs-heading-anchor" href="#Creating-plans-1">Creating plans</a><a class="docs-heading-anchor-permalink" href="#Creating-plans-1" title="Permalink"></a></h3><p>The first thing to do is to create a <a href="PencilFFTs/#PencilFFTs.PencilFFTPlan"><code>PencilFFTPlan</code></a>, which requires information on the global dimensions <span>$N_x × N_y × N_z$</span> of the data, on the transforms that will be applied, and on the way the data is distributed among MPI processes (the MPI Cartesian topology):</p><pre><code class="language-julia">using MPI
using PencilFFTs

MPI.Init()

# Input data dimensions (Nx × Ny × Nz)
dims = (16, 32, 64)

# Apply a real-to-complex (r2c) FFT
transform = Transforms.RFFT()

# MPI topology information
comm = MPI.COMM_WORLD  # we assume MPI.Comm_size(comm) == 12
proc_dims = (3, 4)     # 3×4 Cartesian topology

# Create plan
plan = PencilFFTPlan(dims, transform, proc_dims, comm)</code></pre><p>See the <a href="PencilFFTs/#PencilFFTs.PencilFFTPlan"><code>PencilFFTPlan</code></a> constructor for details on the accepted options, and the <a href="Transforms/#PencilFFTs.Transforms"><code>Transforms</code></a> module for the possible transforms. It is also possible to enable fine-grained performance measurements via the <a href="https://github.com/KristofferC/TimerOutputs.jl">TimerOutputs</a> package, as described in <a href="PencilFFTs/#PencilFFTs.measuring_performance-1">Measuring performance</a>.</p><h3 id="Allocating-data-1"><a class="docs-heading-anchor" href="#Allocating-data-1">Allocating data</a><a class="docs-heading-anchor-permalink" href="#Allocating-data-1" title="Permalink"></a></h3><p>Next, we want to apply the plan on some data. Transforms may only be applied on <a href="Pencils/#PencilFFTs.Pencils.PencilArray"><code>PencilArray</code></a>s, which are array wrappers that include MPI decomposition information. The helper function <a href="PencilFFTs/#PencilFFTs.allocate_input-Tuple{PencilFFTPlan}"><code>allocate_input</code></a> may be used to allocate a <code>PencilArray</code> that is compatible with our plan:</p><pre><code class="language-julia"># In our example, this returns a 3D PencilArray of real data (Float64).
u = allocate_input(plan)

# Fill the array with some (random) data
using Random
randn!(u)</code></pre><p><code>PencilArray</code>s are a subtype of <code>AbstractArray</code>, and thus they support all common array operations.</p><p>Similarly, to preallocate output data, one can use <a href="PencilFFTs/#PencilFFTs.allocate_output-Tuple{PencilFFTPlan}"><code>allocate_output</code></a>:</p><pre><code class="language-julia"># In our example, this returns a 3D PencilArray of complex data (Complex{Float64}).
v = allocate_output(plan)</code></pre><p>This is only required if one wants to apply the plans using a preallocated output (with <code>mul!</code>, see below).</p><h3 id="Applying-plans-1"><a class="docs-heading-anchor" href="#Applying-plans-1">Applying plans</a><a class="docs-heading-anchor-permalink" href="#Applying-plans-1" title="Permalink"></a></h3><p>The interface to apply plans is consistent with that of <a href="https://juliamath.github.io/AbstractFFTs.jl/stable/api/#AbstractFFTs.plan_fft"><code>AbstractFFTs</code></a>. Namely, <code>*</code> and <code>mul!</code> are respectively used for forward transforms without and with preallocated output data. Similarly, <code>\</code> and <code>ldiv!</code> are used for backward transforms.</p><pre><code class="language-julia">using LinearAlgebra  # for mul!, ldiv!

# Apply plan on `u` with `v` as an output
mul!(v, plan, u)

# Apply backward plan on `v` with `w` as an output
w = similar(u)
ldiv!(w, plan, v)  # now w ≈ u</code></pre><p>Note that, consistently with <code>AbstractFFTs</code>, backward transforms are normalised, so that the original data is recovered (possibly up to a very small error) when applying a forward followed by a backward transform.</p><p>Also note that, at this moment, in-place transforms are not supported.</p><h2 id="Working-with-MPI-distributed-data-1"><a class="docs-heading-anchor" href="#Working-with-MPI-distributed-data-1">Working with MPI-distributed data</a><a class="docs-heading-anchor-permalink" href="#Working-with-MPI-distributed-data-1" title="Permalink"></a></h2><p>The implementation of this package is modular. Distributed FFTs are built on top of the <a href="Pencils/#Pencils_module-1"><code>Pencils</code></a> module that handles data decomposition among MPI processes, including the definition of relevant data structures and global data transpositions. The data decomposition functionality may be used independently of the FFTs. See the <a href="Pencils/#Pencils_module-1"><code>Pencils</code></a> module documentation for more details.</p><h2 id="Similar-projects-1"><a class="docs-heading-anchor" href="#Similar-projects-1">Similar projects</a><a class="docs-heading-anchor-permalink" href="#Similar-projects-1" title="Permalink"></a></h2><ul><li><p><a href="https://www-user.tu-chemnitz.de/~potts/workgroup/pippig/software.php.en#pfft">PFFT</a> is a very general parallel FFT library written in C.</p></li><li><p><a href="https://www.p3dfft.net">P3DFFT</a> implements parallel 3D FFTs using pencil decomposition in Fortran and C++.</p></li><li><p><a href="http://www.2decomp.org">2DECOMP&amp;FFT</a> is another parallel 3D FFT library using pencil decomposition written in Fortran.</p></li></ul></article><nav class="docs-footer"><a class="docs-footer-nextpage" href="PencilFFTs/">Distributed FFTs »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label></p><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div><p></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Friday 6 December 2019 21:23">Friday 6 December 2019</span>. Using Julia version 1.2.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></HTML>